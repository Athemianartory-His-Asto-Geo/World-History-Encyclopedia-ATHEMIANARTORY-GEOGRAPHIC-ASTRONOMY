<!DOCTYPE html>
<html>
<head>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <title>World History Encyclopedia: ATHEMIANARTORY GEOGRAPHIC-ASTRONOMY</title>
    <link rel="icon" type="image/x-icon" href="https://upload.wikimedia.org/wikipedia/commons/2/21/Flag_of_Vietnam.svg">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        body { margin: 0; padding: 0; overflow: hidden; background: #000; font-family: 'Segoe UI', Arial, sans-serif; }
        #map { height: 100vh; width: 100%; z-index: 1; background: #000; }
        
    /* Ch·ªânh m√†u cho √¥ Select2 gi·ªëng giao di·ªán c·ªßa b·∫°n */
.select2-container--default .select2-selection--single {
    background-color: rgba(30, 30, 30, 0.9) !important;
    border: 1px solid rgba(255, 255, 255, 0.3) !important;
    border-radius: 8px !important;
    height: 38px !important;
    color: white !important;
}

#country-select {
    background: rgba(30, 30, 30, 0.8);
    color: #ffcc00;
    border: 1px solid rgba(255,255,255,0.3);
    padding: 8px 12px;
    border-radius: 8px;
    outline: none;
    width: 250px;
}
#country-select::placeholder {
    color: rgba(255,255,255,0.5);
}

.select2-container--default .select2-selection--single .select2-selection__rendered {
    color: #ffcc00 !important; /* Ch·ªØ m√†u v√†ng */
    line-height: 35px !important;
    font-weight: bold;
}

.select2-dropdown {
    background-color: #1a1a1a !important;
    color: white !important;
    border: 1px solid #ffcc00 !important;
}

.select2-search__field {
    background-color: #333 !important;
    color: white !important;
    border: 1px solid #444 !important;
}

.select2-results__option--highlighted[aria-selected] {
    background-color: #ffcc00 !important;
    color: black !important;
}
        .system-credit {
            color: #ffffff; 
            font-size: 11px; 
            margin-top: 15px; 
            line-height: 1.5; 
            font-weight: 500; 
            text-shadow: 1px 1px 3px rgba(0,0,0,0.8); 
            letter-spacing: 0.5px; 
            opacity: 1 !important; 
        }
        
        #coords-box {
            position: absolute; top: 20px; right: 20px;
            background: rgba(10, 10, 10, 0.6); backdrop-filter: blur(10px);
            color: #ffcc00; padding: 12px 20px; border-radius: 12px; z-index: 1000;
            border: 1px solid rgba(255, 255, 255, 0.2);
            font-family: 'Courier New', monospace; font-size: 14px; pointer-events: none;
        }

        #ui-panel {
            position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%);
            width: 85%; background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(15px);
            padding: 10px 30px; border-radius: 15px; z-index: 1000; 
            border: 1px solid rgba(255, 255, 255, 0.15);
            text-align: center; box-shadow: 0 5px 20px rgba(0,0,0,0.5);
            transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        #toggle-ui {
            position: absolute; top: -30px; left: 50%; transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.5); color: #ffcc00; 
            border: 1px solid rgba(255,255,255,0.1); border-bottom: none;
            border-radius: 10px 10px 0 0; cursor: pointer; padding: 5px 20px;
            backdrop-filter: blur(5px);
        }

        #year-input {
    background: transparent; border: none;
    font-size: 84px; font-weight: 900; color: #ffcc00; text-align: center;
    width: 350px; outline: none; text-shadow: 0 0 20px rgba(255, 204, 0, 0.4);
    display: block; margin: 0 auto; /* CƒÉn gi·ªØa s·ªë nƒÉm */
}

.system-credit { color: #ffffff !important; opacity: 1 !important; }

        .event-detail { font-size: 20px; color: #ffffff; margin: 5px 0 20px 0; font-style: italic; font-weight: 500; }
        #slider { width: 100%; cursor: pointer; accent-color: #ffcc00; height: 10px; }

        .island-label {
            background: transparent !important; border: none !important;
            color: #ffffff; font-weight: bold; font-size: 16px; text-shadow: 2px 2px 4px #000; white-space: nowrap;
        }
        
        .event-marker-label {
            background: transparent !important;
            border: none !important;
            color: #ff0000;
            font-weight: 900;
            font-size: 20px; /* Gi·∫£m nh·∫π ƒë·ªÉ c√¢n ƒë·ªëi khi zoom xa */
            text-shadow: 0 0 10px #fff, 1px 1px 4px #000;
            text-transform: uppercase;
            text-align: center;
            line-height: 1.1;
            white-space: nowrap;
            /* CƒÉn ch·ªânh quan tr·ªçng */
            width: 150px !important; 
            display: flex;
            justify-content: center;
        }
/* B·∫£ng Wikipedia tr∆∞·ª£t t·ª´ b√™n ph·∫£i */
        #wiki-panel {
            position: absolute;
            top: 20px;
            right: -380px; /* ·∫®n m·∫∑c ƒë·ªãnh */
            width: 320px;
            height: calc(100vh - 180px); /* Kh√¥ng ƒë√® l√™n panel d∆∞·ªõi */
            background: rgba(10, 10, 10, 0.85);
            backdrop-filter: blur(15px);
            z-index: 2000;
            transition: right 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(255, 204, 0, 0.3);
            border-radius: 20px 0 0 20px;
            padding: 20px;
            color: white;
            overflow-y: auto;
            box-shadow: -10px 0 30px rgba(0,0,0,0.5);
        }

        #wiki-panel.active { right: 0; }

        #wiki-close {
            float: right;
            cursor: pointer;
            color: #ffcc00;
            font-size: 24px;
            font-weight: bold;
        }

        #wiki-content h2 { color: #ffcc00; font-size: 20px; margin-top: 0; border-bottom: 1px solid #444; padding-bottom: 10px; }
        #wiki-content img { width: 100%; border-radius: 10px; margin: 15px 0; border: 1px solid #555; }
        #wiki-content p { font-size: 14px; line-height: 1.6; color: #ddd; text-align: justify; }

        .alliance-btn-small {
    background: rgba(255, 255, 255, 0.1);
    color: #fff;
    border: 1px solid rgba(255, 255, 255, 0.2);
    padding: 5px 12px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 11px;
    font-weight: bold;
    transition: all 0.3s;
};

.alliance-btn-small:hover {
    background: #ffcc00;
    color: #000;
    border-color: #ffcc00;
}
        .full-hidden { display: none !important; }
        /* Container t·∫°o h√†ng ngang */
.header-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 15px;
    margin-bottom: 20px;
}

/* Nh√≥m b√™n tr√°i g·ªìm Select v√† c√°c n√∫t Li√™n minh */
left-group {
    display: flex;
    align-items: center;
    gap: 15px; /* TƒÉng kho·∫£ng c√°ch gi·ªØa c√°c √¥ ch·ªçn */
}

/* Ch·ªânh l·∫°i Select ƒë·ªÉ n√≥ kh√¥ng bay t·ª± do n·ªØa */
#country-select {
    position: static !important; /* Bu·ªôc n√≥ ph·∫£i n·∫±m trong h√†ng */
    background: rgba(30, 30, 30, 0.8);
    color: #fff;
    border: 1px solid rgba(255,255,255,0.3);
    padding: 8px 12px;
    border-radius: 8px;
    cursor: pointer;
}

/* L√†m ƒë·∫πp thanh ch·ªçn Li√™n minh */
#alliance-select {
    background: rgba(30, 30, 30, 0.8);
    color: #ffcc00; /* Ch·ªØ m√†u v√†ng cho ƒë·ªìng b·ªô v·ªõi nƒÉm */
    border: 1px solid rgba(255, 255, 255, 0.3);
    padding: 8px 12px;
    border-radius: 8px;
    outline: none;
    cursor: pointer;
    font-size: 13px;
    font-weight: bold;
    min-width: 160px; /* ƒê·ªô r·ªông t·ªëi thi·ªÉu ƒë·ªÉ kh√¥ng b·ªã nh·∫£y ch·ªØ */
}

#alliance-select option {
    background: #1a1a1a;
    color: #fff;
}

/* N√∫t li√™n minh ki·ªÉu m·ªõi */
.alliance-btn-modern {
    background: rgba(255, 255, 255, 0.1);
    color: #fff;
    border: 1px solid rgba(255, 255, 255, 0.2);
    padding: 8px 12px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 12px;
    font-weight: bold;
    transition: all 0.3s;
    white-space: nowrap;
}

.alliance-btn-modern:hover, .alliance-btn-modern.active {
    background: #ffcc00;
    color: #000;
    border-color: #ffcc00;
}

/* Ch·ªânh l·∫°i n√∫t ch·ª•p ·∫£nh */
#screenshot-btn {
    position: static !important; /* Bu·ªôc n√≥ ph·∫£i n·∫±m trong h√†ng */
    background: #ffcc00;
    border: none;
    padding: 8px 15px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
    color: #000;
}
    </style>
</head>
<body> 
    <div id="map"></div>
    <div id="coords-box">LAT: 0.0000 | LNG: 0.0000</div>
<div id="wiki-panel">
        <span id="wiki-close">&times;</span>
        <div id="wiki-content">
            <h2 id="wiki-title">S·ª± ki·ªán</h2>
            <div id="wiki-body">ƒêang l·∫•y d·ªØ li·ªáu...</div>
        </div>
    </div>



    <div id="ui-panel">
        <button id="toggle-ui">‚ñº</button>

        <div class="header-row">
            <div class="left-group">
                <input list="country-list" id="country-select" placeholder="üîç T√¨m qu·ªëc gia...">
                <datalist id="country-list">
    <option value="vietnam">C·ªông Ho√† X√£ H·ªôi Ch·ªß Nghƒ©a Vi·ªát Nam</option>
    <option value="germany">C·ªông Ho√† Li√™n Bang ƒê·ª©c</option>
    <option value="china">Trung Qu·ªëc</option>
    <option value="cuba">C·ªông Ho√† Cuba</option>
    <option value="russia">Li√™n Bang Nga</option>
    <option value="usa">H·ª£p Ch√∫ng Qu·ªëc Hoa K·ª≥</option>
    <option value="france">C·ªông Ho√† Ph√°p</option>
    <option value="japan">Nh·∫≠t B·∫£n Qu·ªëc</option>
    <option value="south_korea">ƒê·∫°i H√†n D√¢n Qu·ªëc</option>
    <option value="india">C·ªông Ho√† ·∫§n ƒê·ªô</option>
    <option value="brazil">C·ªông Ho√† Li√™n Bang Brazil</option>
    <option value="united_kingdom">V∆∞∆°ng Qu·ªëc Anh</option> 
    <option value="canada">V∆∞∆°ng Qu·ªëc Canada</option>
    <option value="australia">Kh·ªëi th·ªãnh v∆∞·ª£ng chung Australia</option>
    <option value="italy">V∆∞∆°ng Qu·ªëc √ù (Italy)</option>
    <option value="spain">V∆∞∆°ng qu·ªëc T√¢y Ban Nha</option>
    <option value="mexico">H·ª£p Ch√∫ng Qu·ªëc Mexico</option>
    <option value="indonesia">C·ªông h√≤a Indonesia</option>
    <option value="thailand">V∆∞∆°ng Qu·ªëc Th√°i Lan</option>
    <option value="south_africa">C·ªông Ho√† Nam Phi</option>
    <option value="turkey">C·ªông ho√† Th·ªï Nhƒ© K·ª≥</option>
    <option value="saudi_arabia">V∆∞∆°ng qu·ªëc ·∫¢ R·∫≠p X√™ √öt</option>
    <option value="argentina">C·ªông h√≤a H·ª£p bang Argentina</option>
    <option value="egypt">C·ªông h√≤a ·∫¢ R·∫≠p Ai C·∫≠p</option>
    <option value="poland">C·ªông Ho√† Ba Lan</option>
    <option value="ukraine">C·ªông Ho√† Ukraine</option>
    <option value="iran">C·ªông h√≤a H·ªìi gi√°o Iran</option>
</datalist>

                <select id="alliance-select" onchange="flyToRegion(this.value)">
                    <option value="" none=">üåê Ch·ªçn Li√™n minh</option>
                    <option value="asean">ASEAN</option>
                    <option value="eu">EUROPEAN UNION (EU)</option>
                    <option value="nato">NATO-OTAN</option>
                    <option value="brics">BRICS</option>
                    <option value="african_union">Li√™n minh Ch√¢u Phi (AU)</option>
                    <option value="arab_league">Li√™n minh ·∫¢ R·∫≠p (Arab League)</option>
                    <option value="opec">Kh·ªëi OPEC (D·∫ßu m·ªè)</option>
                    <option value="mercosur">Kh·ªëi Th·ªã tr∆∞·ªùng chung Nam M·ªπ</option>
                    <option value="commonwealth">Kh·ªëi Th·ªãnh v∆∞·ª£ng chung Anh</option>
                    <option value="un">Li√™n H·ª£p Qu·ªëc (P5)</option>
                    <option value="g7">Kh·ªëi G7</option>
                    <option value="warsaw">Hi·ªáp ∆∞·ªõc Warsaw (L·ªãch s·ª≠)</option>
                    <option value="mena">Li√™n minh Trung ƒê√¥ng - B·∫Øc Phi (MENA)</option>
                    <option value="asia">Ch√¢u √Å</option>
        <option value="europe">Ch√¢u √Çu</option>
        <option value="africa">Ch√¢u Phi</option>
        <option value="americas">Ch√¢u M·ªπ</option>
        <option value="oceania">Ch√¢u ƒê·∫°i D∆∞∆°ng</option>
    </optgroup>

    <optgroup label="üåè TI·ªÇU V√ôNG CH√ÇU √Å">
        <option value="asean">ƒê√¥ng Nam √Å (ASEAN)</option>
        <option value="east_asia">ƒê√¥ng √Å (Trung, Nh·∫≠t, H√†n...)</option>
        <option value="south_asia">Nam √Å (·∫§n ƒê·ªô, Pakistan...)</option>
        <option value="west_asia">T√¢y √Å (Trung ƒê√¥ng)</option>
        <option value="central_asia">Trung √Å</option>
    </optgroup>

    <optgroup label="üåç C√ÅC TI·ªÇU V√ôNG CH√ÇU √ÇU">
    <option value="northern_europe">B·∫Øc √Çu</option>
    <option value="southern_europe">Nam √Çu</option>
    <option value="western_europe">T√¢y √Çu</option>
    <option value="eastern_europe">ƒê√¥ng √Çu</option>
</optgroup>

<optgroup label="üåé C√ÅC TI·ªÇU V√ôNG CH√ÇU M·ª∏">
    <option value="north_america">B·∫Øc M·ªπ</option>
    <option value="central_america">Trung M·ªπ</option>
    <option value="south_america">Nam M·ªπ</option>
    <option value="caribbean">V√πng Caribbean</option>
</optgroup>

<optgroup label="üåç C√ÅC TI·ªÇU V√ôNG CH√ÇU PHI">
    <option value="north_africa">B·∫Øc Phi</option>
    <option value="west_africa">T√¢y Phi</option>
    <option value="east_africa">ƒê√¥ng Phi</option>
    <option value="central_africa">Trung Phi</option>
    <option value="southern_africa">Nam Phi</option>
</optgroup>

<optgroup label=" ƒê·∫†I D∆Ø∆†NG & KH√ÅC">
    <option value="australasia">Australasia (√öc & NZ)</option>
    <option value="melanesia">Melanesia</option>
    <option value="micronesia">Micronesia</option>
    <option value="polynesia">Polynesia</option>
    <option value="antarctica">Ch√¢u Nam C·ª±c</option>
    <option value="zealandia">Zealandia (L·ª•c ƒë·ªãa ch√¨m)</option>
</optgroup>

                    
</select>
            </div>
            <button id="screenshot-btn">üì∏ CH·ª§P ·∫¢NH</button>
        </div>

        <input type="number" id="year-input" value="1784">
        <input type="range" id="slider" min="1784" max="2025" value="1784">
        <div id="event-val" style="color: #ffffff; font-size: 20px; margin-top: 10px; font-style: italic; text-align: center; font-weight: 500;">...</div>

        
        <div class="system-credit">
            B√°ch khoa to√†n th∆∞ th·∫ø gi·ªõi: ATHEMIANARTORY ƒê·ªäA L√ù-THI√äN VƒÇN-L·ªäCH S·ª¨<br>
            World Encyclopedia: ATHEMIANARTORY GEOGRAPHIC-ASTRONOMY-HISTORY
        </div>
    </div>

    <script>
        function showHistoryByCountry(countryName) {
    // 1. X√≥a t·∫•t c·∫£ c√°c Marker (d·∫•u m·ªëc) c≈© tr√™n b·∫£n ƒë·ªì
    clearAllMarkers(); 

    // 2. L·ªçc d·ªØ li·ªáu l·ªãch s·ª≠ ch·ªâ l·∫•y c√°c s·ª± ki·ªán c·ªßa countryName
    const countryHistory = allEvents.filter(event => event.country === countryName);

    // 3. Hi·ªÉn th·ªã c√°c s·ª± ki·ªán ƒë√£ l·ªçc l√™n b·∫£n ƒë·ªì
    countryHistory.forEach(event => {
        addMarker(event.coords, event.description);
    });

    // 4. (T√πy ch·ªçn) T·ª± ƒë·ªông ph√≥ng to v√†o qu·ªëc gia ƒë√≥
    const coords = countryCoords[countryName];
    map.flyTo(coords, 5); 
}
        const historyData = {
    1784: { text: "Chu·∫©n b·ªã l·ª±c l∆∞·ª£ng T√¢y S∆°n", country: "vietnam" },
    1785: { text: "Chi·∫øn th·∫Øng R·∫°ch G·∫ßm - Xo√†i M√∫t", country: "vietnam" },
    1887: { text: "Th√†nh l·∫≠p Li√™n bang ƒê√¥ng D∆∞∆°ng", country: "vietnam" },
    1930: { text: "Th√†nh l·∫≠p ƒê·∫£ng C·ªông s·∫£n Vi·ªát Nam", country: "vietnam" },
    1945: { text: "Vi·ªát Nam Tuy√™n Ng√¥n ƒê·ªôc L·∫≠p Ng√†y 2 Th√°ng 9", country: "vietnam" },
    1954: { text: "Hi·ªáp ƒë·ªãnh Gen√®ve - Chia c·∫Øt Vi·ªát Nam (Vƒ© tuy·∫øn 17)", country: "vietnam" },
    1973: { text: "Hi·ªáp ƒë·ªãnh Paris - K·∫øt th√∫c chi·∫øn tranh Vi·ªát Nam", country: "vietnam" },
    1975: { text: "Gi·∫£i ph√≥ng mi·ªÅn Nam - Th·ªëng nh·∫•t ƒë·∫•t n∆∞·ªõc", country: "vietnam" },
    1989: { text: "B·ª©c t∆∞·ªùng Berlin s·ª•p ƒë·ªï", country: "germany" }, 
    2025: { text: "K·ª∑ ni·ªám 50 nƒÉm ng√†y Th·ªëng nh·∫•t ƒë·∫•t n∆∞·ªõc", country: "vietnam" }
};

const specialEvents = {
    1785: { pos: [10.345, 106.250], text: "TR·∫¨N CHI·∫æN<br>R·∫†CH G·∫¶M XO√ÄI M√öT<br>‚öîÔ∏è" },
    1979: [
        { pos: [22.82, 104.85], text: "H√Ä GIANG ‚öîÔ∏è" },
        { pos: [22.48, 103.97], text: "L√ÄO CAI ‚öîÔ∏è" },
        { pos: [22.67, 106.25], text: "CAO B·∫∞NG ‚öîÔ∏è" },
        { pos: [21.85, 106.75], text: "L·∫†NG S∆†N ‚öîÔ∏è" },
        { pos: [21.54, 107.97], text: "M√ìNG C√ÅI ‚öîÔ∏è" }
    ], 
    1988: { pos: [8.814, 114.28], text: "TR·∫¨N CHI·∫æN<br>G·∫†C MA<br>‚öîÔ∏è" }
    
};

        const countryCoords = {
            
            "japan": { center: [36.2048, 138.2529], zoom: 5, adminName: "Japan" },
    "south_korea": { center: [35.9078, 127.7669], zoom: 7, adminName: "South Korea" },
    "india": { center: [20.5937, 78.9629], zoom: 4, adminName: "India" },
    "brazil": { center: [-14.235, -51.9253], zoom: 4, adminName: "Brazil" },
    "united_kingdom": { center: [55.3781, -3.436], zoom: 5, adminName: "United Kingdom" },
    "canada": { center: [56.1304, -106.3468], zoom: 3, adminName: "Canada" },
    "australia": { center: [-25.2744, 133.7751], zoom: 4, adminName: "Australia" },
    "italy": { center: [41.8719, 12.5674], zoom: 6, adminName: "Italy" },
    "spain": { center: [40.4637, -3.7492], zoom: 6, adminName: "Spain" },
    "mexico": { center: [23.6345, -102.5528], zoom: 5, adminName: "Mexico" },
    "indonesia": { center: [-0.7893, 113.9213], zoom: 4, adminName: "Indonesia" },
    "thailand": { center: [15.87, 100.9925], zoom: 6, adminName: "Thailand" },
    "south_africa": { center: [-30.5595, 22.9375], zoom: 5, adminName: "South Africa" },
    "turkey": { center: [38.9637, 35.2433], zoom: 5, adminName: "Turkey" },
    "saudi_arabia": { center: [23.8859, 45.0792], zoom: 5, adminName: "Saudi Arabia" },
    "argentina": { center: [-38.4161, -63.6167], zoom: 4, adminName: "Argentina" },
    "egypt": { center: [26.8206, 30.8025], zoom: 6, adminName: "Egypt" },
    "poland": { center: [51.9194, 19.1451], zoom: 6, adminName: "Poland" },
    "ukraine": { center: [48.3794, 31.1656], zoom: 6, adminName: "Ukraine" },
    "iran": { center: [32.4279, 53.688], zoom: 5, adminName: "Iran" }
            
        };

        var map = L.map('map', { zoomControl: false, attributionControl: false, preferCanvas: true }).setView([16.0, 108.0], 5); 

        L.tileLayer('https://api.maptiler.com/maps/satellite/{z}/{x}/{y}.jpg?key=DTclk8hQeqS7po0Jyfmi', { maxZoom: 20 }).addTo(map);

        map.on('mousemove', function(e) {
            document.getElementById('coords-box').innerHTML = `LAT: ${e.latlng.lat.toFixed(4)} | LNG: ${e.latlng.lng.toFixed(4)}`;
        });

        const islandMarkers = [
            L.marker([16.5, 112.0], { icon: L.divIcon({ className: 'island-label', html: 'Ho√†ng Sa (VN)' }) }),
            L.marker([10.0, 114.5], { icon: L.divIcon({ className: 'island-label', html: 'Tr∆∞·ªùng Sa (VN)' }) }),
            L.marker([10.2, 103.9], { icon: L.divIcon({ className: 'island-label', html: 'ƒê·∫£o Ph√∫ Qu·ªëc (VN)' }) })
        ];

        function updateLabels() {
            const z = map.getZoom();
            islandMarkers.forEach(m => {
                if (z < 4) { if (map.hasLayer(m)) map.removeLayer(m); }
                else { if (!map.hasLayer(m)) m.addTo(map); }
            });
        }

        let geojsonLayer;
        let activeEventMarker;
        let worldDataCache = null;

        // T·∫£i d·ªØ li·ªáu bi√™n gi·ªõi t·ª´ ngu·ªìn tin c·∫≠y
        async function fetchBorders() {
            try {
                const response = await fetch('https://raw.githubusercontent.com/datasets/geo-countries/master/data/countries.geojson');
                worldDataCache = await response.json();
                renderBorders(document.getElementById('year-input').value);
            } catch (err) {
                console.warn("L·ªói fetch bi√™n gi·ªõi. H√£y ki·ªÉm tra k·∫øt n·ªëi internet.");
            }
        }

        function renderBorders(year) {
    if (!worldDataCache) return;
    if (geojsonLayer) map.removeLayer(geojsonLayer);

    const countryInput = document.getElementById('country-select');
    const selectedCountry = countryInput ? countryInput.value.toLowerCase() : "";
    
    geojsonLayer = L.geoJSON(worldDataCache, {
    style: (feature) => {
        const name = feature.properties.ADMIN || feature.properties.name || "";
        let isHighlighted = false;

        // Gi·ªØ nguy√™n logic b√¥i ƒë·ªè c≈© c·ªßa b·∫°n
        if (activeAlliance && activeAlliance.includes(name)) {
            isHighlighted = true;
        } 
        else if (selectedCountry && countryCoords[selectedCountry]) {
            const targetAdmin = countryCoords[selectedCountry].adminName;
            if (name === targetAdmin || (selectedCountry === "vietnam" && (name === "Vietnam" || name === "Viet Nam"))) {
                isHighlighted = true;
            }
        }

        return {
            color: isHighlighted ? "#ff0000" : "rgba(255, 255, 255, 0.1)",
            weight: isHighlighted ? 3 : 1,
            fillColor: isHighlighted ? "#ff0000" : "transparent",
            fillOpacity: isHighlighted ? 0.3 : 0,
            interactive: true // Ch·ªânh th√†nh true ƒë·ªÉ click ƒë∆∞·ª£c m·ªçi n∆∞·ªõc
        };
    },
    // TH√äM ƒêO·∫†N N√ÄY: Khi click hi·ªán Popup v√† g·ªçi Wiki
    onEachFeature: (feature, layer) => {
        layer.on('click', function (e) {
            const countryName = feature.properties.ADMIN || feature.properties.name;
            
            L.popup()
                .setLatLng(e.latlng)
                .setContent(`
                    <div style="color:black; font-family:Arial; padding:5px;">
                        <b style="font-size:14px;">${countryName}</b><br>
                        <button onclick="fetchWiki('${countryName}')" style="margin-top:8px; cursor:pointer; background:#ffcc00; border:none; border-radius:4px; padding:4px 8px; font-weight:bold;">TRA C·ª®U WIKI</button>
                    </div>
                `)
                .openOn(map);
            
            fetchWiki(countryName); // M·ªü lu√¥n b·∫£ng Wikipedia b√™n ph·∫£i
        });
    }
}).addTo(map);

    geojsonLayer.bringToBack();
    
    // Gi·ªØ nguy√™n logic v·∫Ω Vƒ© tuy·∫øn 17 n·∫øu l√† Vi·ªát Nam
    if (year >= 1954 && year < 1975 && selectedCountry === "vietnam") {
        // ... (gi·ªØ nguy√™n code v·∫Ω polyline c≈© c·ªßa b·∫°n ·ªü ƒë√¢y)
    }
}

        // 1. H√†m l·∫•y d·ªØ li·ªáu t·ª± ƒë·ªông t·ª´ Wikipedia
        async function fetchWiki(eventName) {
            const panel = document.getElementById('wiki-panel');
            const body = document.getElementById('wiki-body');
            const title = document.getElementById('wiki-title');
            
            // Danh s√°ch √°nh x·∫° t√™n s·ª± ki·ªán sang ti√™u ƒë·ªÅ Wikipedia chu·∫©n
            const wikiMap = {
                "Vi·ªát Nam Tuy√™n Ng√¥n ƒê·ªôc L·∫≠p Ng√†y 2 Th√°ng 9": "Tuy√™n ng√¥n ƒë·ªôc l·∫≠p Vi·ªát Nam D√¢n ch·ªß C·ªông h√≤a",
                "Chi·∫øn th·∫Øng R·∫°ch G·∫ßm - Xo√†i M√∫t": "Tr·∫≠n R·∫°ch G·∫ßm ‚Äì Xo√†i M√∫t",
                "Hi·ªáp ƒë·ªãnh Gen√®ve - Chia c·∫Øt Vi·ªát Nam": "Hi·ªáp ƒë·ªãnh Gen√®ve (1954)",
                "Gi·∫£i ph√≥ng mi·ªÅn Nam - Th·ªëng nh·∫•t ƒë·∫•t n∆∞·ªõc": "S·ª± ki·ªán 30 th√°ng 4 nƒÉm 1975",
                "Tr·∫≠n chi·∫øn G·∫°c Ma": "H·∫£i chi·∫øn G·∫°c Ma 1988",
                "Chi·∫øn tranh bi√™n gi·ªõi Vi·ªát - Trung": "Chi·∫øn tranh bi√™n gi·ªõi Vi·ªát‚ÄìTrung, 1979"
            };
            
            const searchName = wikiMap[eventName] || eventName;
            title.innerText = eventName;
            panel.classList.add('active'); // Tr∆∞·ª£t b·∫£ng ra
            body.innerHTML = "<div style='color:#ffcc00'>ƒêang k·∫øt n·ªëi th∆∞ vi·ªán Wikipedia...</div>";

            try {
                const response = await fetch(`https://vi.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(searchName)}`);
                const data = await response.json();
                
                if (data.extract) {
                    body.innerHTML = `
                        ${data.originalimage ? `<img src="${data.originalimage.source}" alt="Event Image">` : ''}
                        <p>${data.extract}</p>
                        <hr style="border:0; border-top:1px solid #444; margin:15px 0;">
                        <a href="${data.content_urls.desktop.page}" target="_blank" style="color:#ffcc00; text-decoration:none; font-weight:bold; font-size:13px;">ƒê·ªåC B√ÄI CHI TI·∫æT TR√äN WIKIPEDIA ‚Üí</a>
                    `;
                } else {
                    body.innerHTML = "<p>Kh√¥ng t√¨m th·∫•y t√≥m t·∫Øt s·ª± ki·ªán. Vui l√≤ng ki·ªÉm tra k·∫øt n·ªëi ho·∫∑c t√™n s·ª± ki·ªán.</p>";
                }
            } catch (error) {
                body.innerHTML = "<p style='color:red'>L·ªói t·∫£i d·ªØ li·ªáu t·ª´ Wikipedia.</p>";
            }
        }

        // 2. N√∫t ƒë√≥ng b·∫£ng th·ªß c√¥ng
        document.getElementById('wiki-close').onclick = () => {
            document.getElementById('wiki-panel').classList.remove('active');
        };

        // 3. H√†m c·∫≠p nh·∫≠t h·ªá th·ªëng (ƒê√£ t√≠ch h·ª£p Wiki)
        let flyTimer;
        
        function updateSystem(val, manualMode = false) {
            if (manualMode) {
                activeAlliance = null; 
            }
            let year = parseInt(val);
            if (isNaN(year)) year = 1784;
            
            const countrySelect = document.getElementById('country-select');
            const mode = countrySelect ? countrySelect.value : "";
            
            // --- ƒêO·∫†N S·ª¨A ƒê·ªÇ L·ªåC THEO N∆Ø·ªöC ---
            const selectedCountry = document.getElementById('country-select').value;
            const dataYear = historyData[year];
            
            let eventName = "...";
            
            // Ki·ªÉm tra: N·∫øu c√≥ d·ªØ li·ªáu nƒÉm ƒë√≥ V√Ä n∆∞·ªõc c·ªßa s·ª± ki·ªán tr√πng v·ªõi n∆∞·ªõc ƒëang ch·ªçn tr√™n b·∫£ng ƒëi·ªÅu khi·ªÉn
            if (dataYear && dataYear.country === selectedCountry) {
                eventName = dataYear.text;
            }
            // --------------------------------

            document.getElementById('event-val').innerHTML = eventName;

            renderBorders(year);

            // Ch·ªâ m·ªü Wiki n·∫øu s·ª± ki·ªán ƒë√≥ thu·ªôc v·ªÅ n∆∞·ªõc ƒëang ch·ªçn
            if (eventName !== "...") {
                fetchWiki(eventName);
            } else {
                document.getElementById('wiki-panel').classList.remove('active');
            }

            // Logic di chuy·ªÉn camera
            clearTimeout(flyTimer);
            flyTimer = setTimeout(() => {
                const mode = document.getElementById('country-select').value;
                if (manualMode) {
                    map.flyTo(countryCoords[mode].center, countryCoords[mode].zoom);
                } else if (mode === "vietnam") {
                    if (year === 1785) map.flyTo([10.342, 106.250], 12);
                    else if (year >= 1887 && year < 1975) map.flyTo([15.5, 107.0], 5);
                    else if (year === 1979) map.flyTo([22.5, 106.0], 7);
                    else if (year === 1988) map.flyTo([8.814, 114.28], 10);
                }
            }, 250);
        renderBorders(parseInt(val));
        }

        map.on('zoomend', () => {
            updateLabels();
            renderBorders(document.getElementById('year-input').value);
        });

        document.getElementById('slider').oninput = (e) => updateSystem(e.target.value);
        document.getElementById('year-input').oninput = (e) => updateSystem(e.target.value);
        document.getElementById('country-select').onchange = () => updateSystem(document.getElementById('year-input').value, true);

        let isPanelHidden = false;
        document.getElementById('toggle-ui').onclick = function() {
            isPanelHidden = !isPanelHidden;
            document.getElementById('ui-panel').style.transform = isPanelHidden ? 'translateX(-50%) translateY(85%)' : 'translateX(-50%) translateY(0)';
            this.innerHTML = isPanelHidden ? '‚ñ≤' : '‚ñº';
        };

        document.addEventListener('keydown', e => {
            if (e.key.toLowerCase() === 'h') {
                document.getElementById('ui-panel').classList.toggle('full-hidden');
                document.getElementById('coords-box').classList.toggle('full-hidden');
            }
        });


        document.getElementById('screenshot-btn').onclick = function() {
    const btn = this;
    const panel = document.getElementById('ui-panel');
    const coords = document.getElementById('coords-box');

    // 1. T·∫°m ·∫©n n√∫t b·∫•m v√† t·ªça ƒë·ªô ƒë·ªÉ ·∫£nh ch·ª•p s·∫°ch s·∫Ω, chuy√™n nghi·ªáp
    btn.style.display = 'none';
    coords.style.opacity = '0'; 

    // 2. Th·ª±c hi·ªán ch·ª•p m√†n h√¨nh
    html2canvas(document.body, {
        useCORS: true, 
        backgroundColor: "#000",
        scale: 2 
    }).then(canvas => {
        // 3. T·∫°o link t·∫£i ·∫£nh t·ª± ƒë·ªông
        const link = document.createElement('a');
        const year = document.getElementById('year-input').value;
        link.download = `BanDo_LichSu_${year}.png`;
        link.href = canvas.toDataURL("image/png");
        link.click();
        
        // 4. Hi·ªán l·∫°i n√∫t b·∫•m v√† t·ªça ƒë·ªô sau khi ch·ª•p xong
        btn.style.display = 'block';
        coords.style.opacity = '1';
    });
};// Danh s√°ch t·ªça ƒë·ªô c√°c khu v·ª±c
        // THAY TH·∫æ TO√ÄN B·ªò ƒêO·∫†N T·ª™ D√íNG 548 ƒê·∫æN 650 B·∫∞NG ƒêO·∫†N N√ÄY
const regionCoords = {
    // --- C√ÅC LI√äN MINH ---
    'asean': {
        center: [10.8, 110.0], zoom: 4,
        countries: ["Vietnam", "Viet Nam", "Thailand", "Cambodia", "Laos", "Myanmar", "Philippines", "Malaysia", "Indonesia", "Brunei", "Timor-Leste", "Singapore"]
    },
    'eu': {
        center: [50.0, 10.0], zoom: 4,
        countries: ["Austria", "Belgium", "Bulgaria", "Croatia", "Cyprus", "Czech Republic", "Denmark", "Estonia", "Finland", "France", "Germany", "Greece", "Hungary", "Ireland", "Italy", "Latvia", "Lithuania", "Luxembourg", "Malta", "Netherlands", "Poland", "Portugal", "Romania", "Slovakia", "Slovenia", "Spain", "Sweden"]
    },
    'nato': { 
        center: [45.0, -20.0], zoom: 3, 
        countries: ["Belgium","Canada","Denmark","France","Iceland","Italy","Luxembourg","Netherlands","Norway","Portugal","United Kingdom","United States of America","Greece","Turkey","Germany","Spain","Czech Republic","Hungary","Poland","Bulgaria","Estonia","Latvia","Lithuania","Romania","Slovakia","Slovenia","Albania","Croatia","Montenegro","North Macedonia","Finland","Sweden"]
    },
    'brics': {
        center: [0.0, 20.0], zoom: 2,
        countries: ["Brazil", "Russia", "India", "China", "South Africa", "Egypt", "Ethiopia", "Iran", "United Arab Emirates"]
    },
    'un': {
        center: [20.0, 0.0], zoom: 2,
        countries: ["United States of America", "Russia", "China", "France", "United Kingdom"]
    },
    'commonwealth': {
        center: [10.0, 20.0], zoom: 2,
        countries: ["United Kingdom", "Canada", "Australia", "New Zealand", "India", "South Africa", "Pakistan", "Bangladesh", "Nigeria", "Malaysia", "Singapore"]
    },
    'warsaw': {
        center: [52.0, 20.0], zoom: 4,
        countries: ["Russia", "Poland", "Germany", "Czech Republic", "Slovakia", "Hungary", "Romania", "Bulgaria", "Albania"]
    },

    // --- C√ÅC L·ª§C ƒê·ªäA ---
    'asia': { 
        center: [30.0, 90.0], zoom: 3, 
        countries: ["Russia", "Afghanistan", "Armenia", "Azerbaijan", "Bahrain", "Bangladesh", "Bhutan", "Brunei Darussalam", "Cambodia", "China", "Cyprus", "Georgia", "India", "Indonesia", "Iran", "Iraq", "Israel", "Japan", "Jordan", "Kazakhstan", "Kuwait", "Kyrgyzstan", "Laos", "Lebanon", "Malaysia", "Maldives", "Mongolia", "Myanmar", "Nepal", "North Korea", "Oman", "Pakistan", "Palestine", "Philippines", "Qatar", "Saudi Arabia", "Singapore", "South Korea", "Sri Lanka", "Syria", "Tajikistan", "Thailand", "Timor-Leste", "Turkey", "Turkmenistan", "United Arab Emirates", "Uzbekistan", "Vietnam", "Yemen"]

    },
    'europe': { 
        center: [52.0, 15.0], 
        zoom: 4, 
        countries: [
            "Albania", "Andorra", "Austria", "Belarus", "Belgium", "Bosnia and Herzegovina", 
            "Bulgaria", "Croatia", "Czechia", "Denmark", "Estonia", "Finland", 
            "France", "Germany", "Greece", "Hungary", "Iceland", "Ireland", "Italy", 
            "Latvia", "Lithuania", "Luxembourg", "Malta", "Moldova", "Monaco", 
            "Montenegro", "Netherlands", "North Macedonia", "Norway", "Poland", 
            "Portugal", "Romania", "Russia", "San Marino", "Republic of Serbia", "Slovakia", 
            "Slovenia", "Spain", "Sweden", "Switzerland", "Ukraine", "United Kingdom",
            "Vatican City", "Liechtenstein"
        ] 
    },
    'africa': { 
        center: [0.0, 20.0], zoom: 3, 
        countries: ["Algeria", "Angola", "Benin", "Botswana", "Burkina Faso", "Burundi", "Cabo Verde", "Cameroon", "Central African Republic", "Chad", "Comoros", "Congo (Republic)", "Congo (Democratic Republic)", "Djibouti", "Egypt", "Equatorial Guinea", "Eritrea", "Eswatini", "Ethiopia", "Gabon", "Gambia", "Ghana", "Guinea", "Guinea-Bissau", "Ivory Coast", "Kenya", "Lesotho", "Liberia", "Libya", "Madagascar", "Malawi", "Mali", "Mauritania", "Mauritius", "Morocco", "Mozambique", "Namibia", "Niger", "Nigeria", "Rwanda", "S√£o Tom√© and Pr√≠ncipe", "Senegal", "Seychelles", "Sierra Leone", "Somalia", "South Africa", "South Sudan", "Sudan", "Tanzania", "Togo", "Tunisia", "Uganda", "Zambia", "Zimbabwe"]

    },
    'americas': { 
        center: [15.0, -85.0], zoom: 3, 
        countries: [
            "United States of America", "Canada", "Mexico", "Brazil", "Argentina", 
            "Chile", "Colombia", "Peru", "Venezuela", "Ecuador", "Bolivia", 
            "Paraguay", "Uruguay", "Guyana", "Suriname", "Guatemala", "Belize", 
            "Honduras", "El Salvador", "Nicaragua", "Costa Rica", "Panama", 
            "Cuba", "Jamaica", "Haiti", "Dominican Republic"
        ] 
    },
    'oceania': { 
        center: [-25.0, 140.0], zoom: 4, 
        countries: ["Australia", "New Zealand", "Papua New Guinea", "Fiji", "Solomon Islands", "Vanuatu"] 
    },
    'antarctica': { 
        center: [-80.0, 0.0], zoom: 3, 
        countries: ["Antarctica"] 
    },
    'zealandia': { 
        center: [-40.0, 170.0], zoom: 4, 
        countries: ["New Zealand", "New Caledonia"] 
    },

    // --- C√ÅC TI·ªÇU V√ôNG ---
    'east_asia': { center: [35.0, 115.0], zoom: 4, countries: ["China", "Japan", "South Korea", "North Korea", "Mongolia", "Taiwan"] },
    'south_asia': { center: [22.0, 78.0], zoom: 4, countries: ["India", "Pakistan", "Bangladesh", "Sri Lanka", "Nepal", "Bhutan", "Afghanistan"] },
    'west_asia': { center: [25.0, 45.0], zoom: 4, countries: ["Saudi Arabia", "Iran", "Iraq", "Turkey", "United Arab Emirates", "Israel", "Jordan", "Kuwait", "Oman", "Qatar", "Syria", "Yemen"] },
    'central_asia': { center: [45.0, 65.0], zoom: 4, countries: ["Kazakhstan", "Kyrgyzstan", "Tajikistan", "Turkmenistan", "Uzbekistan"] },
    'northern_europe': { center: [62.0, 15.0], zoom: 4, countries: ["Norway", "Sweden", "Finland", "Denmark", "Iceland", "Estonia", "Latvia", "Lithuania"] },
    'southern_europe': { center: [40.0, 15.0], zoom: 5, countries: ["Italy", "Spain", "Portugal", "Greece", "Albania", "Croatia", "Serbia", "Slovenia", "Montenegro"] },
    'western_europe': { center: [48.0, 2.0], zoom: 5, countries: ["France", "Belgium", "Netherlands", "Luxembourg", "Switzerland", "Austria", "Germany", "United Kingdom", "Ireland"] },
    'eastern_europe': { center: [50.0, 30.0], zoom: 4, countries: ["Russia", "Ukraine", "Poland", "Romania", "Bulgaria", "Hungary", "Czech Republic", "Slovakia", "Belarus", "Moldova"] },
    'north_america': { center: [45.0, -100.0], zoom: 3, countries: ["United States of America", "Canada", "Mexico", "Greenland"] },
    'central_america': { center: [15.0, -85.0], zoom: 5, countries: ["Guatemala", "Belize", "El Salvador", "Honduras", "Nicaragua", "Costa Rica", "Panama"] },
    'south_america': { center: [-20.0, -60.0], zoom: 3, countries: ["Brazil", "Argentina", "Chile", "Colombia", "Peru", "Venezuela", "Ecuador", "Bolivia", "Paraguay", "Uruguay", "Guyana", "Suriname"] },
    'north_africa': { center: [25.0, 15.0], zoom: 4, countries: ["Egypt", "Libya", "Tunisia", "Algeria", "Morocco", "Western Sahara", "Sudan"] },
    'west_africa': { center: [15.0, 0.0], zoom: 4, countries: ["Nigeria", "Ghana", "Senegal", "Mali", "Ivory Coast", "Niger", "Burkina Faso", "Guinea", "Benin", "Togo", "Sierra Leone", "Liberia", "Mauritania", "Gambia", "Guinea-Bissau"] },
    'southern_africa': { center: [-25.0, 25.0], zoom: 4, countries: ["South Africa", "Namibia", "Botswana", "Zimbabwe", "Mozambique", "Lesotho", "Swaziland"] },
    'melanesia': { center: [-8.0, 150.0], zoom: 4, countries: ["Papua New Guinea", "Fiji", "Solomon Islands", "Vanuatu"] },
    'micronesia': { center: [7.0, 150.0], zoom: 4, countries: ["Palau", "Kiribati", "Marshall Islands", "Nauru"] },
    'polynesia': { center: [-15.0, -160.0], zoom: 3, countries: ["Samoa", "Tonga", "Tuvalu", "Cook Islands", "French Polynesia"] }
};
    


            
        

        let activeAlliance = null; // Bi·∫øn l∆∞u kh·ªëi ƒëang ƒë∆∞·ª£c ch·ªçn

        // H√†m th·ª±c hi·ªán hi·ªáu ·ª©ng bay
        function flyToRegion(region) {
    if (!region) return;

    // X√≥a qu·ªëc gia ƒëang ch·ªçn ƒë·ªÉ ∆∞u ti√™n hi·ªÉn th·ªã Li√™n minh
    document.getElementById('country-select').value = ""; 

    const data = regionCoords[region];
    if (data) {
        activeAlliance = data.countries; 
        renderBorders(document.getElementById('year-input').value);
        map.flyTo(data.center, data.zoom, { animate: true, duration: 2 });
    }
}
        fetchBorders(); 
// X·ª≠ l√Ω s·ª± ki·ªán khi ch·ªçn qu·ªëc gia t·ª´ danh s√°ch
document.getElementById('country-select').addEventListener('change', function(e) {
    const val = e.target.value.toLowerCase();
    const currentYear = document.getElementById('year-input').value;

    // 1. T·∫Øt ch·∫ø ƒë·ªô li√™n minh ƒë·ªÉ ∆∞u ti√™n hi·ªÉn th·ªã qu·ªëc gia l·∫ª
    activeAlliance = null; 
    
    // 2. C·∫≠p nh·∫≠t h·ªá th·ªëng (bay ƒë·∫øn qu·ªëc gia, ki·ªÉm tra s·ª± ki·ªán l·ªãch s·ª≠)
    updateSystem(currentYear, true);
    
    // 3. √âP B·∫¢N ƒê·ªí V·∫º L·∫†I BI√äN GI·ªöI NGAY L·∫¨P T·ª®C
    renderBorders(currentYear);
});    

    </script>


</body>
</html>
