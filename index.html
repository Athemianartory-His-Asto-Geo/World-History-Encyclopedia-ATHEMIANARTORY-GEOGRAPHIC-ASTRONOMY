<!DOCTYPE html>
<html>
<head>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <title>World History Encyclopedia: ATHEMIANARTORY GEOGRAPHIC-ASTRONOMY</title>
    <link rel="icon" type="image/x-icon" href="https://upload.wikimedia.org/wikipedia/commons/2/21/Flag_of_Vietnam.svg">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        body { margin: 0; padding: 0; overflow: hidden; background: #000; font-family: 'Segoe UI', Arial, sans-serif; }
        #map { height: 100vh; width: 100%; z-index: 1; background: #000; }
        
    /* Ch·ªânh m√†u cho √¥ Select2 gi·ªëng giao di·ªán c·ªßa b·∫°n */
.select2-container--default .select2-selection--single {
    background-color: rgba(30, 30, 30, 0.9) !important;
    border: 1px solid rgba(255, 255, 255, 0.3) !important;
    border-radius: 8px !important;
    height: 38px !important;
    color: white !important;
}

#country-select {
    background: rgba(30, 30, 30, 0.8);
    color: #ffcc00;
    border: 1px solid rgba(255,255,255,0.3);
    padding: 8px 12px;
    border-radius: 8px;
    outline: none;
    width: 250px;
}
#country-select::placeholder {
    color: rgba(255,255,255,0.5);
}

.select2-container--default .select2-selection--single .select2-selection__rendered {
    color: #ffcc00 !important; /* Ch·ªØ m√†u v√†ng */
    line-height: 35px !important;
    font-weight: bold;
}

.select2-dropdown {
    background-color: #1a1a1a !important;
    color: white !important;
    border: 1px solid #ffcc00 !important;
}

.select2-search__field {
    background-color: #333 !important;
    color: white !important;
    border: 1px solid #444 !important;
}

.select2-results__option--highlighted[aria-selected] {
    background-color: #ffcc00 !important;
    color: black !important;
}
        .system-credit {
            color: #ffffff; 
            font-size: 11px; 
            margin-top: 15px; 
            line-height: 1.5; 
            font-weight: 500; 
            text-shadow: 1px 1px 3px rgba(0,0,0,0.8); 
            letter-spacing: 0.5px; 
            opacity: 1 !important; 
        }
        
        #coords-box {
            position: absolute; top: 20px; right: 20px;
            background: rgba(10, 10, 10, 0.6); backdrop-filter: blur(10px);
            color: #ffcc00; padding: 12px 20px; border-radius: 12px; z-index: 1000;
            border: 1px solid rgba(255, 255, 255, 0.2);
            font-family: 'Courier New', monospace; font-size: 14px; pointer-events: none;
        }

        #ui-panel {
            position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%);
            width: 85%; background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(15px);
            padding: 10px 30px; border-radius: 15px; z-index: 1000; 
            border: 1px solid rgba(255, 255, 255, 0.15);
            text-align: center; box-shadow: 0 5px 20px rgba(0,0,0,0.5);
            transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        #toggle-ui {
            position: absolute; top: -30px; left: 50%; transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.5); color: #ffcc00; 
            border: 1px solid rgba(255,255,255,0.1); border-bottom: none;
            border-radius: 10px 10px 0 0; cursor: pointer; padding: 5px 20px;
            backdrop-filter: blur(5px);
        }

        #year-input {
    background: transparent; border: none;
    font-size: 84px; font-weight: 900; color: #ffcc00; text-align: center;
    width: 350px; outline: none; text-shadow: 0 0 20px rgba(255, 204, 0, 0.4);
    display: block; margin: 0 auto; /* CƒÉn gi·ªØa s·ªë nƒÉm */
}

.system-credit { color: #ffffff !important; opacity: 1 !important; }

        .event-detail { font-size: 20px; color: #ffffff; margin: 5px 0 20px 0; font-style: italic; font-weight: 500; }
        #slider { width: 100%; cursor: pointer; accent-color: #ffcc00; height: 10px; }

        .island-label {
            background: transparent !important; border: none !important;
            color: #ffffff; font-weight: bold; font-size: 16px; text-shadow: 2px 2px 4px #000; white-space: nowrap;
        }
        
        .event-marker-label {
            background: transparent !important;
            border: none !important;
            color: #ff0000;
            font-weight: 900;
            font-size: 20px; /* Gi·∫£m nh·∫π ƒë·ªÉ c√¢n ƒë·ªëi khi zoom xa */
            text-shadow: 0 0 10px #fff, 1px 1px 4px #000;
            text-transform: uppercase;
            text-align: center;
            line-height: 1.1;
            white-space: nowrap;
            /* CƒÉn ch·ªânh quan tr·ªçng */
            width: 150px !important; 
            display: flex;
            justify-content: center;
        }
/* B·∫£ng Wikipedia tr∆∞·ª£t t·ª´ b√™n ph·∫£i */
        #wiki-panel {
            position: absolute;
            top: 20px;
            right: -380px; /* ·∫®n m·∫∑c ƒë·ªãnh */
            width: 320px;
            height: calc(100vh - 180px); /* Kh√¥ng ƒë√® l√™n panel d∆∞·ªõi */
            background: rgba(10, 10, 10, 0.85);
            backdrop-filter: blur(15px);
            z-index: 2000;
            transition: right 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(255, 204, 0, 0.3);
            border-radius: 20px 0 0 20px;
            padding: 20px;
            color: white;
            overflow-y: auto;
            box-shadow: -10px 0 30px rgba(0,0,0,0.5);
        }

        #wiki-panel.active { right: 0; }

        #wiki-close {
            float: right;
            cursor: pointer;
            color: #ffcc00;
            font-size: 24px;
            font-weight: bold;
        }

        #wiki-content h2 { color: #ffcc00; font-size: 20px; margin-top: 0; border-bottom: 1px solid #444; padding-bottom: 10px; }
        #wiki-content img { width: 100%; border-radius: 10px; margin: 15px 0; border: 1px solid #555; }
        #wiki-content p { font-size: 14px; line-height: 1.6; color: #ddd; text-align: justify; }

        .alliance-btn-small {
    background: rgba(255, 255, 255, 0.1);
    color: #fff;
    border: 1px solid rgba(255, 255, 255, 0.2);
    padding: 5px 12px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 11px;
    font-weight: bold;
    transition: all 0.3s;
};

.alliance-btn-small:hover {
    background: #ffcc00;
    color: #000;
    border-color: #ffcc00;
}
        .full-hidden { display: none !important; }
        /* Container t·∫°o h√†ng ngang */
.header-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 15px;
    margin-bottom: 20px;
}

/* Nh√≥m b√™n tr√°i g·ªìm Select v√† c√°c n√∫t Li√™n minh */
left-group {
    display: flex;
    align-items: center;
    gap: 15px; /* TƒÉng kho·∫£ng c√°ch gi·ªØa c√°c √¥ ch·ªçn */
}

/* Ch·ªânh l·∫°i Select ƒë·ªÉ n√≥ kh√¥ng bay t·ª± do n·ªØa */
#country-select {
    position: static !important; /* Bu·ªôc n√≥ ph·∫£i n·∫±m trong h√†ng */
    background: rgba(30, 30, 30, 0.8);
    color: #fff;
    border: 1px solid rgba(255,255,255,0.3);
    padding: 8px 12px;
    border-radius: 8px;
    cursor: pointer;
}

/* L√†m ƒë·∫πp thanh ch·ªçn Li√™n minh */
#alliance-select {
    background: rgba(30, 30, 30, 0.8);
    color: #ffcc00; /* Ch·ªØ m√†u v√†ng cho ƒë·ªìng b·ªô v·ªõi nƒÉm */
    border: 1px solid rgba(255, 255, 255, 0.3);
    padding: 8px 12px;
    border-radius: 8px;
    outline: none;
    cursor: pointer;
    font-size: 13px;
    font-weight: bold;
    min-width: 160px; /* ƒê·ªô r·ªông t·ªëi thi·ªÉu ƒë·ªÉ kh√¥ng b·ªã nh·∫£y ch·ªØ */
}

#alliance-select option {
    background: #1a1a1a;
    color: #fff;
}

/* N√∫t li√™n minh ki·ªÉu m·ªõi */
.alliance-btn-modern {
    background: rgba(255, 255, 255, 0.1);
    color: #fff;
    border: 1px solid rgba(255, 255, 255, 0.2);
    padding: 8px 12px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 12px;
    font-weight: bold;
    transition: all 0.3s;
    white-space: nowrap;
}

.alliance-btn-modern:hover, .alliance-btn-modern.active {
    background: #ffcc00;
    color: #000;
    border-color: #ffcc00;
}

/* Ch·ªânh l·∫°i n√∫t ch·ª•p ·∫£nh */
#screenshot-btn {
    position: static !important; /* Bu·ªôc n√≥ ph·∫£i n·∫±m trong h√†ng */
    background: #ffcc00;
    border: none;
    padding: 8px 15px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
    color: #000;
}
    </style>
</head>
<body> 
    <div id="map"></div>
    <div id="coords-box">LAT: 0.0000 | LNG: 0.0000</div>
<div id="wiki-panel">
        <span id="wiki-close">&times;</span>
        <div id="wiki-content">
            <h2 id="wiki-title">S·ª± ki·ªán</h2>
            <div id="wiki-body">ƒêang l·∫•y d·ªØ li·ªáu...</div>
        </div>
    </div>



    <div id="ui-panel">
        <button id="toggle-ui">‚ñº</button>

        <div class="header-row">
            <div class="left-group">
                <input list="country-list" id="country-select" placeholder="üîç T√¨m qu·ªëc gia...">
                <datalist id="country-list">
                    <option value="vietnam">C·ªông Ho√† X√£ H·ªôi Ch·ªß Nghƒ©a Vi·ªát Nam</option>
                    <option value="germany">C·ªông Ho√† Li√™n Bang ƒê·ª©c</option>
                    <option value="china">Trung Qu·ªëc</option>
                    <option value="cuba">C·ªông Ho√† Cuba</option>
                    <option value="russia">Li√™n Bang Nga</option>
                    <option value="usa">H·ª£p Ch√∫ng Qu·ªëc Hoa K·ª≥</option>
                    <option value="france">C√¥ng Ho√† Ph√°p</option>
                </datalist>

                <select id="alliance-select" onchange="flyToRegion(this.value)">
                    <option value="" disabled selected>üåê Ch·ªçn Li√™n minh</option>
                    <option value="asean">ASEAN</option>
                    <option value="eu">EUROPEAN UNION (EU)</option>
                    <option value="nato">NATO-OTAN</option>
                    <option value="brics">BRICS</option>
                    <option value="african_union">Li√™n minh Ch√¢u Phi (AU)</option>
                </select>
            </div>
            <button id="screenshot-btn">üì∏ CH·ª§P ·∫¢NH</button>
        </div>

        <input type="number" id="year-input" value="1784">
        <input type="range" id="slider" min="1784" max="2025" value="1784">
        
        <div class="system-credit">
            H·ªÜ TH·ªêNG ƒê·ªäA L√ù-L·ªäCH S·ª¨-THI√äN VƒÇN - ATHEMIANARTORY<br>
            WORLD HISTORY ENCYCLOPEDIA
        </div>
    </div>

    <script>
        function showHistoryByCountry(countryName) {
    // 1. X√≥a t·∫•t c·∫£ c√°c Marker (d·∫•u m·ªëc) c≈© tr√™n b·∫£n ƒë·ªì
    clearAllMarkers(); 

    // 2. L·ªçc d·ªØ li·ªáu l·ªãch s·ª≠ ch·ªâ l·∫•y c√°c s·ª± ki·ªán c·ªßa countryName
    const countryHistory = allEvents.filter(event => event.country === countryName);

    // 3. Hi·ªÉn th·ªã c√°c s·ª± ki·ªán ƒë√£ l·ªçc l√™n b·∫£n ƒë·ªì
    countryHistory.forEach(event => {
        addMarker(event.coords, event.description);
    });

    // 4. (T√πy ch·ªçn) T·ª± ƒë·ªông ph√≥ng to v√†o qu·ªëc gia ƒë√≥
    const coords = countryCoords[countryName];
    map.flyTo(coords, 5); 
}
        const historyData = {
    1784: { text: "Chu·∫©n b·ªã l·ª±c l∆∞·ª£ng T√¢y S∆°n", country: "vietnam" },
    1785: { text: "Chi·∫øn th·∫Øng R·∫°ch G·∫ßm - Xo√†i M√∫t", country: "vietnam" },
    1887: { text: "Th√†nh l·∫≠p Li√™n bang ƒê√¥ng D∆∞∆°ng", country: "vietnam" },
    1930: { text: "Th√†nh l·∫≠p ƒê·∫£ng C·ªông s·∫£n Vi·ªát Nam", country: "vietnam" },
    1945: { text: "Vi·ªát Nam Tuy√™n Ng√¥n ƒê·ªôc L·∫≠p Ng√†y 2 Th√°ng 9", country: "vietnam" },
    1954: { text: "Hi·ªáp ƒë·ªãnh Gen√®ve - Chia c·∫Øt Vi·ªát Nam (Vƒ© tuy·∫øn 17)", country: "vietnam" },
    1973: { text: "Hi·ªáp ƒë·ªãnh Paris - K·∫øt th√∫c chi·∫øn tranh Vi·ªát Nam", country: "vietnam" },
    1975: { text: "Gi·∫£i ph√≥ng mi·ªÅn Nam - Th·ªëng nh·∫•t ƒë·∫•t n∆∞·ªõc", country: "vietnam" },
    1989: { text: "B·ª©c t∆∞·ªùng Berlin s·ª•p ƒë·ªï", country: "germany" }, 
    2025: { text: "K·ª∑ ni·ªám 50 nƒÉm ng√†y Th·ªëng nh·∫•t ƒë·∫•t n∆∞·ªõc", country: "vietnam" }
};

const specialEvents = {
    1785: { pos: [10.345, 106.250], text: "TR·∫¨N CHI·∫æN<br>R·∫†CH G·∫¶M XO√ÄI M√öT<br>‚öîÔ∏è" },
    1979: [
        { pos: [22.82, 104.85], text: "H√Ä GIANG ‚öîÔ∏è" },
        { pos: [22.48, 103.97], text: "L√ÄO CAI ‚öîÔ∏è" },
        { pos: [22.67, 106.25], text: "CAO B·∫∞NG ‚öîÔ∏è" },
        { pos: [21.85, 106.75], text: "L·∫†NG S∆†N ‚öîÔ∏è" },
        { pos: [21.54, 107.97], text: "M√ìNG C√ÅI ‚öîÔ∏è" }
    ], 
    1988: { pos: [8.814, 114.28], text: "TR·∫¨N CHI·∫æN<br>G·∫†C MA<br>‚öîÔ∏è" }
    
};

        const countryCoords = {
            
            "germany": { center: [51.1657, 10.4515], zoom: 6, adminName: "Germany" },
            "vietnam": { center: [16.0, 108.0], zoom: 6, adminName: "Vietnam" },
            "china": { center: [35.0, 105.0], zoom: 4.5, adminName: "China" },
            "cuba": { center: [21.5217, -77.7812], zoom: 7, adminName: "Cuba" },
            "russia": { center: [61.524, 105.318], zoom: 3, adminName: "Russia" },
            "usa": { center: [37.0902, -95.7129], zoom: 4, adminName: "United States of America" },
            "france": { center: [46.2276, 2.2137], zoom: 6, adminName: "France" }
        };

        var map = L.map('map', { zoomControl: false, attributionControl: false, preferCanvas: true }).setView([16.0, 108.0], 5); 

        L.tileLayer('https://api.maptiler.com/maps/satellite/{z}/{x}/{y}.jpg?key=DTclk8hQeqS7po0Jyfmi', { maxZoom: 20 }).addTo(map);

        map.on('mousemove', function(e) {
            document.getElementById('coords-box').innerHTML = `LAT: ${e.latlng.lat.toFixed(4)} | LNG: ${e.latlng.lng.toFixed(4)}`;
        });

        const islandMarkers = [
            L.marker([16.5, 112.0], { icon: L.divIcon({ className: 'island-label', html: 'Ho√†ng Sa (VN)' }) }),
            L.marker([10.0, 114.5], { icon: L.divIcon({ className: 'island-label', html: 'Tr∆∞·ªùng Sa (VN)' }) }),
            L.marker([10.2, 103.9], { icon: L.divIcon({ className: 'island-label', html: 'ƒê·∫£o Ph√∫ Qu·ªëc (VN)' }) })
        ];

        function updateLabels() {
            const z = map.getZoom();
            islandMarkers.forEach(m => {
                if (z < 4) { if (map.hasLayer(m)) map.removeLayer(m); }
                else { if (!map.hasLayer(m)) m.addTo(map); }
            });
        }

        let geojsonLayer;
        let activeEventMarker;
        let worldDataCache = null;

        // T·∫£i d·ªØ li·ªáu bi√™n gi·ªõi t·ª´ ngu·ªìn tin c·∫≠y
        async function fetchBorders() {
            try {
                const response = await fetch('https://raw.githubusercontent.com/datasets/geo-countries/master/data/countries.geojson');
                worldDataCache = await response.json();
                renderBorders(document.getElementById('year-input').value);
            } catch (err) {
                console.warn("L·ªói fetch bi√™n gi·ªõi. H√£y ki·ªÉm tra k·∫øt n·ªëi internet.");
            }
        }

        function renderBorders(year) {
            if (!worldDataCache) return;
            if (geojsonLayer) map.removeLayer(geojsonLayer);

            const selectedCountry = document.getElementById('country-select').value;
            const targetAdmin = countryCoords[selectedCountry].adminName;

            geojsonLayer = L.geoJSON(worldDataCache, {
                style: (feature) => {
                    const name = feature.properties.ADMIN || feature.properties.name || "";
                    let isHighlighted = false;

                    if (activeAlliance && activeAlliance.includes(name)) {
                        isHighlighted = true;
                    } else {
                        if (selectedCountry === "vietnam") {
                            if (name === "Vietnam" || name === "Viet Nam" || name.includes("Paracel") || name.includes("Spratly")) {
                                isHighlighted = true;
                            }
                        } else {
                            if (name === targetAdmin) isHighlighted = true;
                        }
                    }

                    return isHighlighted ? {
                        color: "#ff0000", weight: 3, fillColor: "#ff0000", fillOpacity: 0.15, interactive: true
                    } : {
                        color: "rgba(255, 255, 255, 0.1)", weight: 1, fillOpacity: 0, interactive: false
                    };
                }
            }).addTo(map);

            geojsonLayer.bringToBack();

            // S·ª¨A L·ªñI Vƒ® TUY·∫æN 17 T·∫†I ƒê√ÇY
            if (year >= 1954 && year < 1975 && selectedCountry === "vietnam") {
                // 1. V·∫Ω ƒë∆∞·ªùng chia c·∫Øt
                const line17 = L.polyline([[17.0, 106.0], [17.0, 108.5]], {
                    color: '#ffcc00', weight: 4, dashArray: '8, 8'
                }).addTo(map);

                // 2. Nh√£n Mi·ªÅn B·∫Øc (S·ª≠a t√™n bi·∫øn kh√¥ng d·∫•u)
                const labelNorth = L.marker([18.2, 105.8], { 
                    icon: L.divIcon({ 
                        className: 'island-label', 
                        html: '<div class="dmz-label" style="color:#00ff00">VNDCCH (MI·ªÄN B·∫ÆC)</div>' 
                    }) 
                }).addTo(map);

                // 3. Nh√£n Mi·ªÅn Nam
                const labelSouth = L.marker([15.8, 107.5], { 
                    icon: L.divIcon({ 
                        className: 'island-label', 
                        html: '<div class="dmz-label" style="color:#ffff00">VNCH (MI·ªÄN NAM)</div>' 
                    }) 
                }).addTo(map);

                // Gom v√†o layer ƒë·ªÉ t·ª± x√≥a khi chuy·ªÉn nƒÉm
                geojsonLayer.addLayer(line17);
                geojsonLayer.addLayer(labelNorth);
                geojsonLayer.addLayer(labelSouth);
            }
        }


        // 1. H√†m l·∫•y d·ªØ li·ªáu t·ª± ƒë·ªông t·ª´ Wikipedia
        async function fetchWiki(eventName) {
            const panel = document.getElementById('wiki-panel');
            const body = document.getElementById('wiki-body');
            const title = document.getElementById('wiki-title');
            
            // Danh s√°ch √°nh x·∫° t√™n s·ª± ki·ªán sang ti√™u ƒë·ªÅ Wikipedia chu·∫©n
            const wikiMap = {
                "Vi·ªát Nam Tuy√™n Ng√¥n ƒê·ªôc L·∫≠p Ng√†y 2 Th√°ng 9": "Tuy√™n ng√¥n ƒë·ªôc l·∫≠p Vi·ªát Nam D√¢n ch·ªß C·ªông h√≤a",
                "Chi·∫øn th·∫Øng R·∫°ch G·∫ßm - Xo√†i M√∫t": "Tr·∫≠n R·∫°ch G·∫ßm ‚Äì Xo√†i M√∫t",
                "Hi·ªáp ƒë·ªãnh Gen√®ve - Chia c·∫Øt Vi·ªát Nam": "Hi·ªáp ƒë·ªãnh Gen√®ve (1954)",
                "Gi·∫£i ph√≥ng mi·ªÅn Nam - Th·ªëng nh·∫•t ƒë·∫•t n∆∞·ªõc": "S·ª± ki·ªán 30 th√°ng 4 nƒÉm 1975",
                "Tr·∫≠n chi·∫øn G·∫°c Ma": "H·∫£i chi·∫øn G·∫°c Ma 1988",
                "Chi·∫øn tranh bi√™n gi·ªõi Vi·ªát - Trung": "Chi·∫øn tranh bi√™n gi·ªõi Vi·ªát‚ÄìTrung, 1979"
            };
            
            const searchName = wikiMap[eventName] || eventName;
            title.innerText = eventName;
            panel.classList.add('active'); // Tr∆∞·ª£t b·∫£ng ra
            body.innerHTML = "<div style='color:#ffcc00'>ƒêang k·∫øt n·ªëi th∆∞ vi·ªán Wikipedia...</div>";

            try {
                const response = await fetch(`https://vi.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(searchName)}`);
                const data = await response.json();
                
                if (data.extract) {
                    body.innerHTML = `
                        ${data.originalimage ? `<img src="${data.originalimage.source}" alt="Event Image">` : ''}
                        <p>${data.extract}</p>
                        <hr style="border:0; border-top:1px solid #444; margin:15px 0;">
                        <a href="${data.content_urls.desktop.page}" target="_blank" style="color:#ffcc00; text-decoration:none; font-weight:bold; font-size:13px;">ƒê·ªåC B√ÄI CHI TI·∫æT TR√äN WIKIPEDIA ‚Üí</a>
                    `;
                } else {
                    body.innerHTML = "<p>Kh√¥ng t√¨m th·∫•y t√≥m t·∫Øt s·ª± ki·ªán. Vui l√≤ng ki·ªÉm tra k·∫øt n·ªëi ho·∫∑c t√™n s·ª± ki·ªán.</p>";
                }
            } catch (error) {
                body.innerHTML = "<p style='color:red'>L·ªói t·∫£i d·ªØ li·ªáu t·ª´ Wikipedia.</p>";
            }
        }

        // 2. N√∫t ƒë√≥ng b·∫£ng th·ªß c√¥ng
        document.getElementById('wiki-close').onclick = () => {
            document.getElementById('wiki-panel').classList.remove('active');
        };

        // 3. H√†m c·∫≠p nh·∫≠t h·ªá th·ªëng (ƒê√£ t√≠ch h·ª£p Wiki)
        let flyTimer;
        
        function updateSystem(val, manualMode = false) {
            if (manualMode) {
                activeAlliance = null; 
            }
            let year = parseInt(val);
            if (isNaN(year)) year = 1784;
            
            document.getElementById('year-input').value = year;
            document.getElementById('slider').value = year;
            
            // --- ƒêO·∫†N S·ª¨A ƒê·ªÇ L·ªåC THEO N∆Ø·ªöC ---
            const selectedCountry = document.getElementById('country-select').value;
            const dataYear = historyData[year];
            
            let eventName = "...";
            
            // Ki·ªÉm tra: N·∫øu c√≥ d·ªØ li·ªáu nƒÉm ƒë√≥ V√Ä n∆∞·ªõc c·ªßa s·ª± ki·ªán tr√πng v·ªõi n∆∞·ªõc ƒëang ch·ªçn tr√™n b·∫£ng ƒëi·ªÅu khi·ªÉn
            if (dataYear && dataYear.country === selectedCountry) {
                eventName = dataYear.text;
            }
            // --------------------------------

            document.getElementById('event-val').innerHTML = eventName;

            renderBorders(year);

            // Ch·ªâ m·ªü Wiki n·∫øu s·ª± ki·ªán ƒë√≥ thu·ªôc v·ªÅ n∆∞·ªõc ƒëang ch·ªçn
            if (eventName !== "...") {
                fetchWiki(eventName);
            } else {
                document.getElementById('wiki-panel').classList.remove('active');
            }

            // Logic di chuy·ªÉn camera
            clearTimeout(flyTimer);
            flyTimer = setTimeout(() => {
                const mode = document.getElementById('country-select').value;
                if (manualMode) {
                    map.flyTo(countryCoords[mode].center, countryCoords[mode].zoom);
                } else if (mode === "vietnam") {
                    if (year === 1785) map.flyTo([10.342, 106.250], 12);
                    else if (year >= 1887 && year < 1975) map.flyTo([15.5, 107.0], 5);
                    else if (year === 1979) map.flyTo([22.5, 106.0], 7);
                    else if (year === 1988) map.flyTo([8.814, 114.28], 10);
                }
            }, 250);
        }

        map.on('zoomend', () => {
            updateLabels();
            renderBorders(document.getElementById('year-input').value);
        });

        document.getElementById('slider').oninput = (e) => updateSystem(e.target.value);
        document.getElementById('year-input').oninput = (e) => updateSystem(e.target.value);
        document.getElementById('country-select').onchange = () => updateSystem(document.getElementById('year-input').value, true);

        let isPanelHidden = false;
        document.getElementById('toggle-ui').onclick = function() {
            isPanelHidden = !isPanelHidden;
            document.getElementById('ui-panel').style.transform = isPanelHidden ? 'translateX(-50%) translateY(85%)' : 'translateX(-50%) translateY(0)';
            this.innerHTML = isPanelHidden ? '‚ñ≤' : '‚ñº';
        };

        document.addEventListener('keydown', e => {
            if (e.key.toLowerCase() === 'h') {
                document.getElementById('ui-panel').classList.toggle('full-hidden');
                document.getElementById('coords-box').classList.toggle('full-hidden');
            }
        });


        document.getElementById('screenshot-btn').onclick = function() {
    const btn = this;
    const panel = document.getElementById('ui-panel');
    const coords = document.getElementById('coords-box');

    // 1. T·∫°m ·∫©n n√∫t b·∫•m v√† t·ªça ƒë·ªô ƒë·ªÉ ·∫£nh ch·ª•p s·∫°ch s·∫Ω, chuy√™n nghi·ªáp
    btn.style.display = 'none';
    coords.style.opacity = '0'; 

    // 2. Th·ª±c hi·ªán ch·ª•p m√†n h√¨nh
    html2canvas(document.body, {
        useCORS: true, 
        backgroundColor: "#000",
        scale: 2 
    }).then(canvas => {
        // 3. T·∫°o link t·∫£i ·∫£nh t·ª± ƒë·ªông
        const link = document.createElement('a');
        const year = document.getElementById('year-input').value;
        link.download = `BanDo_LichSu_${year}.png`;
        link.href = canvas.toDataURL("image/png");
        link.click();
        
        // 4. Hi·ªán l·∫°i n√∫t b·∫•m v√† t·ªça ƒë·ªô sau khi ch·ª•p xong
        btn.style.display = 'block';
        coords.style.opacity = '1';
    });
};// Danh s√°ch t·ªça ƒë·ªô c√°c khu v·ª±c
        const regionCoords = {
    'asean': {
        center: [10.8, 110.0], zoom: 4,

        countries: ["Vietnam", "Viet Nam", "Thailand", "Cambodia", "Laos", "Myanmar", "Philippines", "Malaysia", "Indonesia", "Brunei", "Timor-Leste", "Singapore"]
    },
    'eu': {
        center: [50.0, 10.0], zoom: 4,
        countries: ["Austria", "Belgium", "Bulgaria", "Croatia", "Cyprus", "Czech Republic", "Denmark", "Estonia", "Finland", "France", "Germany", "Greece", "Hungary", "Ireland", "Italy", "Latvia", "Lithuania", "Luxembourg", "Malta", "Netherlands", "Poland", "Portugal", "Romania", "Slovakia", "Slovenia", "Spain", "Sweden"]

    },

            'nato': { 
                center: [45.0, -20.0], zoom: 3, 
                countries: ["Belgium","Canada","Denmark","France","Iceland","Italy","Luxembourg","Netherlands","Norway","Portugal","United Kingdom","United States of America","Greece","Turkey","Germany","Spain","Czech Republic","Hungary","Poland","Bulgaria","Estonia","Latvia","Lithuania","Romania","Slovakia","Slovenia","Albania","Croatia","Montenegro","North Macedonia","Finland","Sweden"
]

            },
            'mena': { 
                center: [25.0, 30.0], zoom: 4, 
                countries: [ "Algeria", "Bahrain", "Egypt", "Iran", "Iraq", "Israel", "Jordan", "Kuwait", "Lebanon", "Libya", "Morocco", "Oman", "Palestine", "Qatar", "Saudi Arabia", "Syria", "Tunisia","United Arab Emirates","Yemen","Mauritania","Sudan"]
            },
            'brics': {
        center: [0.0, 20.0], zoom: 2,
        countries: ["Brazil", "Russia", "India", "China", "South Africa", "Egypt", "Ethiopia", "Iran", "United Arab Emirates"]
    },
    'g7': {
        center: [45.0, -10.0], zoom: 3,
        countries: ["Canada", "France", "Germany", "Italy", "Japan", "United Kingdom", "United States of America"]
    },
    'african_union': {
        center: [1.0, 20.0], zoom: 3,
        countries: ["Algeria", "Angola", "Benin", "Botswana", "Burkina Faso", "Burundi", "Cameroon", "Cape Verde", "Central African Republic", "Chad", "Comoros", "Congo", "Democratic Republic of the Congo", "Djibouti", "Egypt", "Equatorial Guinea", "Eritrea", "Ethiopia", "Gabon", "Gambia", "Ghana", "Guinea", "Guinea-Bissau", "Ivory Coast", "Kenya", "Lesotho", "Liberia", "Libya", "Madagascar", "Malawi", "Mali", "Mauritania", "Mauritius", "Morocco", "Mozambique", "Namibia", "Niger", "Nigeria", "Rwanda", "Sao Tome and Principe", "Senegal", "Seychelles", "Sierra Leone", "Somalia", "South Africa", "South Sudan", "Sudan", "Swaziland", "Tanzania", "Togo", "Tunisia", "Uganda", "Zambia", "Zimbabwe"]
    },

};
            
        

        let activeAlliance = null; // Bi·∫øn l∆∞u kh·ªëi ƒëang ƒë∆∞·ª£c ch·ªçn

        // H√†m th·ª±c hi·ªán hi·ªáu ·ª©ng bay
        function flyToRegion(region) {
    if (!region) return; // N·∫øu ch·ªçn d√≤ng ti√™u ƒë·ªÅ th√¨ kh√¥ng l√†m g√¨ c·∫£

    const data = regionCoords[region];
    if (data) {
        // 1. C·∫≠p nh·∫≠t danh s√°ch c√°c n∆∞·ªõc trong kh·ªëi ƒë·ªÉ b√¥i ƒë·ªè
        activeAlliance = data.countries; 
        
        // 2. V·∫Ω l·∫°i bi√™n gi·ªõi ngay l·∫≠p t·ª©c ƒë·ªÉ th·∫•y m√†u ƒë·ªè
        renderBorders(document.getElementById('year-input').value);

        // 3. Th·ª±c hi·ªán hi·ªáu ·ª©ng bay
        map.flyTo(data.center, data.zoom, {
            animate: true,
            duration: 2 
        });
    }
}
        fetchBorders(); 
document.getElementById('country-select').addEventListener('change', function(e) {
    updateSystem(document.getElementById('year-input').value, true);
});
    </script>


</body>
</html>
