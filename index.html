<!DOCTYPE html>
<html>
<head>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <title>World History Encyclopedia: ATHEMIANARTORY GEOGRAPHIC-ASTRONOMY</title>
    <link rel="icon" type="image/x-icon" href="https://upload.wikimedia.org/wikipedia/commons/2/21/Flag_of_Vietnam.svg">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        body { margin: 0; padding: 0; overflow: hidden; background: #000; font-family: 'Segoe UI', Arial, sans-serif; }
        #map { height: 100vh; width: 100%; z-index: 1; background: #000; }
        
path.leaflet-interactive {
    filter: drop-shadow(0 0 2px #00FF00);
    transition: all 0.3s;
}
path.leaflet-interactive:hover {
    stroke-width: 4;
    stroke: #fff; /* Di chu·ªôt v√†o s·∫Ω s√°ng tr·∫Øng l√™n */
}

    /* Ch·ªânh m√†u cho √¥ Select2 gi·ªëng giao di·ªán c·ªßa b·∫°n */
.select2-container--default .select2-selection--single {
    background-color: rgba(30, 30, 30, 0.9) !important;
    border: 1px solid rgba(255, 255, 255, 0.3) !important;
    border-radius: 8px !important;
    height: 38px !important;
    color: white !important;
}

#climate-select {
    background: rgba(30, 30, 30, 0.8);
    color: #00f2ff; /* M√†u xanh neon cho kh√°c bi·ªát v·ªõi Li√™n minh */
    border: 1px solid rgba(0, 242, 255, 0.3);
    padding: 8px 12px;
    border-radius: 8px;
    outline: none;
    cursor: pointer;
    font-size: 13px;
    font-weight: bold;
}
#climate-select option { background: #1a1a1a; color: #fff; }
.equator-label {
    color: #00f2ff;
    font-size: 10px;
    font-weight: bold;
    letter-spacing: 2px;
    text-shadow: 1px 1px 3px #000;
    pointer-events: none; /* Kh√¥ng c·∫£n tr·ªü vi·ªác click b·∫£n ƒë·ªì */
}

/* Nh√£n t√™n c√°c ƒë·ªõi kh√≠ h·∫≠u */
.climate-label {
    background: transparent !important;
    border: none !important;
    color: rgba(255, 255, 255, 0.5); /* M√†u tr·∫Øng m·ªù cho tinh t·∫ø */
    font-size: 12px;
    font-weight: bold;
    letter-spacing: 5px; /* Gi√£n ch·ªØ ra cho gi·ªëng b·∫£n ƒë·ªì chuy√™n nghi·ªáp */
    text-transform: uppercase;
    pointer-events: none;
}

#country-select {
    background: rgba(30, 30, 30, 0.8);
    color: #ffcc00;
    border: 1px solid rgba(255,255,255,0.3);
    padding: 8px 12px;
    border-radius: 8px;
    outline: none;
    width: 250px;
}
#country-select::placeholder {
    color: rgba(255,255,255,0.5);
}

.select2-container--default .select2-selection--single .select2-selection__rendered {
    color: #ffcc00 !important; /* Ch·ªØ m√†u v√†ng */
    line-height: 35px !important;
    font-weight: bold;
}

.select2-dropdown {
    background-color: #1a1a1a !important;
    color: white !important;
    border: 1px solid #ffcc00 !important;
}

.select2-search__field {
    background-color: #333 !important;
    color: white !important;
    border: 1px solid #444 !important;
}

.select2-results__option--highlighted[aria-selected] {
    background-color: #ffcc00 !important;
    color: black !important;
}
        .system-credit {
            color: #ffffff; 
            font-size: 11px; 
            margin-top: 15px; 
            line-height: 1.5; 
            font-weight: 500; 
            text-shadow: 1px 1px 3px rgba(0,0,0,0.8); 
            letter-spacing: 0.5px; 
            opacity: 1 !important; 
        }
        
        #coords-box {
            position: absolute; top: 20px; right: 20px;
            background: rgba(10, 10, 10, 0.6); backdrop-filter: blur(10px);
            color: #ffcc00; padding: 12px 20px; border-radius: 12px; z-index: 1000;
            border: 1px solid rgba(255, 255, 255, 0.2);
            font-family: 'Courier New', monospace; font-size: 14px; pointer-events: none;
        }
#ui-panel {
    position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%);
    width: 85%; background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(15px);
    padding: 10px 30px; border-radius: 15px; 
    z-index: 1000; 
    border: 1px solid rgba(255, 255, 255, 0.15);
    text-align: center; 
    transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    
    /* Th√™m 2 d√≤ng n√†y */
    pointer-events: none; 
}

/* ƒê·∫£m b·∫£o t·∫•t c·∫£ c√°c n√∫t, √¥ ch·ªçn v√† slider b√™n trong panel v·∫´n b·∫•m ƒë∆∞·ª£c */
#ui-panel > *, #ui-panel .header-row *, #slider {
    pointer-events: auto;
}

        #toggle-ui {
            position: absolute; top: -30px; left: 50%; transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.5); color: #ffcc00; 
            border: 1px solid rgba(255,255,255,0.1); border-bottom: none;
            border-radius: 10px 10px 0 0; cursor: pointer; padding: 5px 20px;
            backdrop-filter: blur(5px);
        }

        #year-input {
    background: transparent; border: none;
    font-size: 84px; font-weight: 900; color: #ffcc00; text-align: center;
    width: 350px; outline: none; text-shadow: 0 0 20px rgba(255, 204, 0, 0.4);
    display: block; margin: 0 auto; /* CƒÉn gi·ªØa s·ªë nƒÉm */
}

.system-credit { color: #ffffff !important; opacity: 1 !important; }

        .event-detail { font-size: 20px; color: #ffffff; margin: 5px 0 20px 0; font-style: italic; font-weight: 500; }
       #slider { 
    width: 100%; 
    cursor: pointer; 
    accent-color: #ffcc00; 
    height: 25px; /* TƒÉng ƒë·ªô d√†y ƒë·ªÉ d·ªÖ ch·∫°m tr√∫ng */
    position: relative;
    z-index: 9999; /* ƒê·∫£m b·∫£o n·ªïi l√™n tr√™n c√πng */
    pointer-events: auto !important; 
    margin: 15px 0;
}
.climate-zone-text {
    color: #ffffff;
    font-size: 14px;
    font-weight: bold;
    text-transform: uppercase;
    text-align: center;
    pointer-events: none;
    text-shadow: 2px 2px 4px #000; /* ƒê·ªï b√≥ng ƒë·ªÉ n·ªïi tr√™n n·ªÅn x√°m */
}


        .island-label {
            background: transparent !important; border: none !important;
            color: #ffffff; font-weight: bold; font-size: 16px; text-shadow: 2px 2px 4px #000; white-space: nowrap;
        }
        
        .event-marker-label {
            background: transparent !important;
            border: none !important;
            color: #ff0000;
            font-weight: 900;
            font-size: 20px; /* Gi·∫£m nh·∫π ƒë·ªÉ c√¢n ƒë·ªëi khi zoom xa */
            text-shadow: 0 0 10px #fff, 1px 1px 4px #000;
            text-transform: uppercase;
            text-align: center;
            line-height: 1.1;
            white-space: nowrap;
            /* CƒÉn ch·ªânh quan tr·ªçng */
            width: 150px !important; 
            display: flex;
            justify-content: center;
        }
/* B·∫£ng Wikipedia tr∆∞·ª£t t·ª´ b√™n ph·∫£i */
        #wiki-panel {
            position: absolute;
            top: 20px;
            right: -380px; /* ·∫®n m·∫∑c ƒë·ªãnh */
            width: 320px;
            height: calc(100vh - 180px); /* Kh√¥ng ƒë√® l√™n panel d∆∞·ªõi */
            background: rgba(10, 10, 10, 0.85);
            backdrop-filter: blur(15px);
            z-index: 2000;
            transition: right 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(255, 204, 0, 0.3);
            border-radius: 20px 0 0 20px;
            padding: 20px;
            color: white;
            overflow-y: auto;
            box-shadow: -10px 0 30px rgba(0,0,0,0.5);
        }

        #wiki-panel.active { right: 0; }

        #wiki-close {
            float: right;
            cursor: pointer;
            color: #ffcc00;
            font-size: 24px;
            font-weight: bold;
        }

        #wiki-content h2 { color: #ffcc00; font-size: 20px; margin-top: 0; border-bottom: 1px solid #444; padding-bottom: 10px; }
        #wiki-content img { width: 100%; border-radius: 10px; margin: 15px 0; border: 1px solid #555; }
        #wiki-content p { font-size: 14px; line-height: 1.6; color: #ddd; text-align: justify; }

/* Th√†nh th·∫ø n√†y: */
.alliance-btn-small {
    background: rgba(255, 255, 255, 0.1);
    color: #fff;
    border: 1px solid rgba(255, 255, 255, 0.2);
    padding: 5px 12px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 11px;
    font-weight: bold;
    transition: all 0.3s;
} /* KH√îNG c√≥ d·∫•u ; ·ªü ƒë√¢y */


.alliance-btn-small:hover {
    background: #ffcc00;
    color: #000;
    border-color: #ffcc00;
}
        .full-hidden { display: none !important; }
        /* Container t·∫°o h√†ng ngang */
.header-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 15px;
    margin-bottom: 20px;
}

/* Nh√≥m b√™n tr√°i g·ªìm Select v√† c√°c n√∫t Li√™n minh */
left-group {
    display: flex;
    align-items: center;
    gap: 15px; /* TƒÉng kho·∫£ng c√°ch gi·ªØa c√°c √¥ ch·ªçn */
}

/* Ch·ªânh l·∫°i Select ƒë·ªÉ n√≥ kh√¥ng bay t·ª± do n·ªØa */
#country-select {
    position: static !important; /* Bu·ªôc n√≥ ph·∫£i n·∫±m trong h√†ng */
    background: rgba(30, 30, 30, 0.8);
    color: #fff;
    border: 1px solid rgba(255,255,255,0.3);
    padding: 8px 12px;
    border-radius: 8px;
    cursor: pointer;
}

/* L√†m ƒë·∫πp thanh ch·ªçn Li√™n minh */
#alliance-select {
    background: rgba(30, 30, 30, 0.8);
    color: #ffcc00; /* Ch·ªØ m√†u v√†ng cho ƒë·ªìng b·ªô v·ªõi nƒÉm */
    border: 1px solid rgba(255, 255, 255, 0.3);
    padding: 8px 12px;
    border-radius: 8px;
    outline: none;
    cursor: pointer;
    font-size: 13px;
    font-weight: bold;
    min-width: 160px; /* ƒê·ªô r·ªông t·ªëi thi·ªÉu ƒë·ªÉ kh√¥ng b·ªã nh·∫£y ch·ªØ */
}

#alliance-select option {
    background: #1a1a1a;
    color: #fff;
}

/* N√∫t li√™n minh ki·ªÉu m·ªõi */
.alliance-btn-modern {
    background: rgba(255, 255, 255, 0.1);
    color: #fff;
    border: 1px solid rgba(255, 255, 255, 0.2);
    padding: 8px 12px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 12px;
    font-weight: bold;
    transition: all 0.3s;
    white-space: nowrap;
}

.climate-label {
            color: rgba(255, 255, 255, 0.4);
            font-size: 10px;
            font-style: italic;
            white-space: nowrap;
            pointer-events: none;
        }

        /* Ch·ªØ hi·ªÉn th·ªã t√™n ƒê·ªõi kh√≠ h·∫≠u (m·ªù ·∫£o ·ªü gi·ªØa b·∫£n ƒë·ªì) */
        .climate-zone-text {
            color: rgba(255, 255, 255, 0.2);
            font-size: 13px;
            font-weight: bold;
            letter-spacing: 3px;
            text-transform: uppercase;
            text-align: center;
            pointer-events: none;
        }

.alliance-btn-modern:hover, .alliance-btn-modern.active {
    background: #ffcc00;
    color: #000;
    border-color: #ffcc00;
}

/* Ch·ªânh l·∫°i n√∫t ch·ª•p ·∫£nh */
#screenshot-btn {
    position: static !important; /* Bu·ªôc n√≥ ph·∫£i n·∫±m trong h√†ng */
    background: #ffcc00;
    border: none;
    padding: 8px 15px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
    color: #000;
}
    </style>
</head>
<body> 
    <div id="map"></div>
    <div id="coords-box">LAT: 0.0000 | LNG: 0.0000</div>

    <div id="custom-panel" style="position: absolute; top: 50%; left: -260px; transform: translateY(-50%); width: 250px; background: rgba(0,0,0,0.9); color: white; padding: 15px; border-radius: 0 15px 15px 0; border: 1px solid #ffcc00; z-index: 2000; transition: 0.4s;">
        <button id="toggle-custom" style="position: absolute; right: -35px; top: 50%; transform: translateY(-50%); background: #ffcc00; border: none; padding: 10px 5px; cursor: pointer; font-weight: bold; border-radius: 0 5px 5px 0;">üñåÔ∏è<br>T<br>√ô<br>Y<br><br>C<br>H<br>·ªà<br>N<br>H</button>
        <h3 style="color: #ffcc00; margin: 0 0 10px 0; font-size: 16px;">CH·∫æ ƒê·ªò T√î M√ÄU</h3>
        <p style="font-size: 12px; color: #ccc;">‚Ä¢ <b>·∫§n ƒë√∫p chu·ªôt (Double Click)</b> v√†o m·ªôt n∆∞·ªõc ƒë·ªÉ t√¥/x√≥a m√†u v√†ng.</p>
        <button onclick="clearCustomColors()" style="width:100%; background:#cc0000; color:white; border:none; padding:8px; cursor:pointer; border-radius:5px; font-weight:bold; margin-top:10px;">X√ìA T·∫§T C·∫¢ M√ÄU</button>
    </div>

    <div id="wiki-panel">
        <span id="wiki-close">&times;</span>
        <div id="wiki-content">
            <h2 id="wiki-title">S·ª± ki·ªán</h2>
            <div id="wiki-body">ƒêang l·∫•y d·ªØ li·ªáu...</div>
        </div>
    </div>



    <div id="ui-panel">
    <button id="toggle-ui">‚ñº</button>

    <div class="header-row">
        <div class="left-group">
            <select id="climate-select" onchange="toggleClimateLayer(this.value)">
                <option value="none">üå°Ô∏è Kh√≠ h·∫≠u: T·∫Øt</option>
                <option value="lines">üåê Hi·ªán c√°c ƒë∆∞·ªùng Vƒ© ƒë·ªô</option>
                <option value="zones">üå§Ô∏è Hi·ªán c√°c ƒêai kh√≠ h·∫≠u</option>
                <option value="all">‚ú® Hi·ªán t·∫•t c·∫£</option>
            </select>
            <div class="left-group">
                <input list="country-list" id="country-select" placeholder="üîç T√¨m qu·ªëc gia...">
                <datalist id="country-list">
    <option value="vietnam">C·ªông Ho√† X√£ H·ªôi Ch·ªß Nghƒ©a Vi·ªát Nam</option>
    <option value="germany">C·ªông Ho√† Li√™n Bang ƒê·ª©c</option>
    <option value="china">Trung Qu·ªëc</option>
    <option value="cuba">C·ªông Ho√† Cuba</option>
    <option value="russia">Li√™n Bang Nga</option>
    <option value="usa">H·ª£p Ch√∫ng Qu·ªëc Hoa K·ª≥</option>
    <option value="france">C·ªông Ho√† Ph√°p</option>
    <option value="japan">Nh·∫≠t B·∫£n Qu·ªëc</option>
    <option value="south_korea">ƒê·∫°i H√†n D√¢n Qu·ªëc</option>
    <option value="india">C·ªông Ho√† ·∫§n ƒê·ªô</option>
    <option value="brazil">C·ªông Ho√† Li√™n Bang Brazil</option>
    <option value="united_kingdom">V∆∞∆°ng Qu·ªëc Anh</option> 
    <option value="canada">V∆∞∆°ng Qu·ªëc Canada</option>
    <option value="australia">Kh·ªëi th·ªãnh v∆∞·ª£ng chung Australia</option>
    <option value="italy">V∆∞∆°ng Qu·ªëc √ù (Italy)</option>
    <option value="spain">V∆∞∆°ng qu·ªëc T√¢y Ban Nha</option>
    <option value="mexico">H·ª£p Ch√∫ng Qu·ªëc Mexico</option>
    <option value="indonesia">C·ªông h√≤a Indonesia</option>
    <option value="thailand">V∆∞∆°ng Qu·ªëc Th√°i Lan</option>
    <option value="south_africa">C·ªông Ho√† Nam Phi</option>
    <option value="turkey">C·ªông ho√† Th·ªï Nhƒ© K·ª≥</option>
    <option value="saudi_arabia">V∆∞∆°ng qu·ªëc ·∫¢ R·∫≠p X√™ √öt</option>
    <option value="argentina">C·ªông h√≤a H·ª£p bang Argentina</option>
    <option value="egypt">C·ªông h√≤a ·∫¢ R·∫≠p Ai C·∫≠p</option>
    <option value="poland">C·ªông Ho√† Ba Lan</option>
    <option value="ukraine">C·ªông Ho√† Ukraine</option>
    <option value="iran">C·ªông h√≤a H·ªìi gi√°o Iran</option>

</datalist>

                <select id="alliance-select" onchange="flyToRegion(this.value)">
                    <option value="" selected">üåê CH·ªåN C√ÅC KHU V·ª∞C-LI√äN MINH</option>
                    <option value="asean">ASEAN</option>
                    <option value="eu">EUROPEAN UNION (EU)</option>
                    <option value="nato">NATO-OTAN</option>
                    <option value="brics">BRICS</option>
                    <option value="african_union">Li√™n minh Ch√¢u Phi (AU)</option>
                    <option value="arab_league">Li√™n minh ·∫¢ R·∫≠p (Arab League)</option>
                    <option value="opec">Kh·ªëi OPEC (D·∫ßu m·ªè)</option>
                    <option value="mercosur">Kh·ªëi Th·ªã tr∆∞·ªùng chung Nam M·ªπ</option>
                    <option value="commonwealth">Kh·ªëi Th·ªãnh v∆∞·ª£ng chung Anh</option>
                    <option value="un">Li√™n H·ª£p Qu·ªëc (P5)</option>
                    <option value="g7">Kh·ªëi G7</option>
                    <option value="warsaw">Hi·ªáp ∆∞·ªõc Warsaw (L·ªãch s·ª≠)</option>
                    <option value="mena">Li√™n minh Trung ƒê√¥ng - B·∫Øc Phi (MENA)</option>
                    <option value="asia">Ch√¢u √Å</option>
        <option value="europe">Ch√¢u √Çu</option>
        <option value="africa">Ch√¢u Phi</option>
        <option value="americas">Ch√¢u M·ªπ</option>
        <option value="oceania">Ch√¢u ƒê·∫°i D∆∞∆°ng</option>
    </optgroup>

    <optgroup label="üåè TI·ªÇU V√ôNG CH√ÇU √Å">
        <option value="asean">ƒê√¥ng Nam √Å (ASEAN)</option>
        <option value="east_asia">ƒê√¥ng √Å (Trung, Nh·∫≠t, H√†n...)</option>
        <option value="south_asia">Nam √Å (·∫§n ƒê·ªô, Pakistan...)</option>
        <option value="west_asia">T√¢y √Å (Trung ƒê√¥ng)</option>
        <option value="central_asia">Trung √Å</option>
        <option value="north_asia">B·∫Øc √Å (Nga, M√¥ng C·ªï)</option>
        <option value="middle_east">Trung ƒê√¥ng</option>
        <option value="southeast_asia">ƒê√¥ng Nam √Å</option>
    </optgroup>

    <optgroup label="üåç C√ÅC TI·ªÇU V√ôNG CH√ÇU √ÇU">
    <option value="northern_europe">B·∫Øc √Çu</option>
    <option value="southern_europe">Nam √Çu</option>
    <option value="western_europe">T√¢y √Çu</option>
    <option value="eastern_europe">ƒê√¥ng √Çu</option>
    <option value="central_europe">Trung √Çu</option>
</optgroup>

<optgroup label="üåé C√ÅC TI·ªÇU V√ôNG CH√ÇU M·ª∏">
    <option value="north_america">B·∫Øc M·ªπ</option>
    <option value="central_america">Trung M·ªπ</option>
    <option value="south_america">Nam M·ªπ</option>
    <option value="caribbean">V√πng Caribbean</option>
</optgroup>

<optgroup label="üåç C√ÅC TI·ªÇU V√ôNG CH√ÇU PHI">
    <option value="north_africa">B·∫Øc Phi</option>
    <option value="west_africa">T√¢y Phi</option>
    <option value="east_africa">ƒê√¥ng Phi</option>
    <option value="central_africa">Trung Phi</option>
    <option value="southern_africa">Nam Phi</option>
    <option value="central_southern_africa">Trung Nam Phi</option>
    <option value='south_west_africa'>T√¢y Nam Phi</option>
    <option value='south_west_africa'>ƒê√¥ng Nam Phi</option>

</optgroup>

<optgroup label=" ƒê·∫†I D∆Ø∆†NG & KH√ÅC">
    <option value="australasia">Australasia (√öc & NZ)</option>
    <option value="melanesia">Melanesia</option>
    <option value="micronesia">Micronesia</option>
    <option value="polynesia">Polynesia</option>
    <option value="antarctica">Ch√¢u Nam C·ª±c</option>
    <option value="zealandia">Zealandia (L·ª•c ƒë·ªãa ch√¨m)</option>
</optgroup>

                    
</select>
            </div>
            <button id="screenshot-btn">üì∏ CH·ª§P ·∫¢NH</button>
        </div>
    <div class="timeline-container">
        <input type="number" id="year-input" value="1784">
        <input type="range" id="slider" min="1784" max="2025" value="1784">
        <div id="event-val">...</div>
    </div>
        
<div class="system-credit">
            B√°ch khoa to√†n th∆∞ th·∫ø gi·ªõi: ATHEMIANARTORY ƒê·ªäA L√ù-THI√äN VƒÇN-L·ªäCH S·ª¨<br>
            World Encyclopedia: ATHEMIANARTORY GEOGRAPHIC-ASTRONOMY-HISTORY
        </div>
    </div>

    <script>
        function showHistoryByCountry(countryName) {
    // 1. X√≥a t·∫•t c·∫£ c√°c Marker (d·∫•u m·ªëc) c≈© tr√™n b·∫£n ƒë·ªì
    clearAllMarkers(); 

    // 2. L·ªçc d·ªØ li·ªáu l·ªãch s·ª≠ ch·ªâ l·∫•y c√°c s·ª± ki·ªán c·ªßa countryName
    const countryHistory = allEvents.filter(event => event.country === countryName);

    // 3. Hi·ªÉn th·ªã c√°c s·ª± ki·ªán ƒë√£ l·ªçc l√™n b·∫£n ƒë·ªì
    countryHistory.forEach(event => {
        addMarker(event.coords, event.description);
    });

    // 4. (T√πy ch·ªçn) T·ª± ƒë·ªông ph√≥ng to v√†o qu·ªëc gia ƒë√≥
    const coords = countryCoords[countryName];
    map.flyTo(coords, 5); 
}
        const historyData = {
    1784: { text: "Chu·∫©n b·ªã l·ª±c l∆∞·ª£ng T√¢y S∆°n", country: "vietnam" },
    1785: { text: "Chi·∫øn th·∫Øng R·∫°ch G·∫ßm - Xo√†i M√∫t", country: "vietnam" },
    1887: { text: "Th√†nh l·∫≠p Li√™n bang ƒê√¥ng D∆∞∆°ng", country: "vietnam" },
    1930: { text: "Th√†nh l·∫≠p ƒê·∫£ng C·ªông s·∫£n Vi·ªát Nam", country: "vietnam" },
    1945: { text: "Vi·ªát Nam Tuy√™n Ng√¥n ƒê·ªôc L·∫≠p Ng√†y 2 Th√°ng 9", country: "vietnam" },
    1954: { text: "Hi·ªáp ƒë·ªãnh Gen√®ve - Chia c·∫Øt Vi·ªát Nam (Vƒ© tuy·∫øn 17)", country: "vietnam" },
    1973: { text: "Hi·ªáp ƒë·ªãnh Paris - K·∫øt th√∫c chi·∫øn tranh Vi·ªát Nam", country: "vietnam" },
    1975: { text: "Gi·∫£i ph√≥ng mi·ªÅn Nam - Th·ªëng nh·∫•t ƒë·∫•t n∆∞·ªõc", country: "vietnam" },
    1989: { text: "B·ª©c t∆∞·ªùng Berlin s·ª•p ƒë·ªï", country: "germany" }, 
    2025: { text: "K·ª∑ ni·ªám 50 nƒÉm ng√†y Th·ªëng nh·∫•t ƒë·∫•t n∆∞·ªõc", country: "vietnam" },
    1950: { text: "Chi·∫øn d·ªãch Bi√™n Gi·ªõi 1950", country: "vietnam" },
    1972: { text: "Chi·∫øn d·ªãch Qu·∫£ng Tr·ªã 1972", country: "vietnam" },
    1988: { text: "H·∫£i chi·∫øn Tr∆∞·ªùng Sa 1988", country: "vietnam" }
};

const specialEvents = {
    1785: { pos: [10.345, 106.250], text: "TR·∫¨N CHI·∫æN<br>R·∫†CH G·∫¶M XO√ÄI M√öT<br>‚öîÔ∏è" },
    1979: [
        { pos: [22.82, 104.85], text: "H√Ä GIANG ‚öîÔ∏è" },
        { pos: [22.48, 103.97], text: "L√ÄO CAI ‚öîÔ∏è" },
        { pos: [22.67, 106.25], text: "CAO B·∫∞NG ‚öîÔ∏è" },
        { pos: [21.85, 106.75], text: "L·∫†NG S∆†N ‚öîÔ∏è" },
        { pos: [21.54, 107.97], text: "M√ìNG C√ÅI ‚öîÔ∏è" }
    ], 
    1988: { pos: [8.814, 114.28], text: "TR·∫¨N CHI·∫æN<br>G·∫†C MA<br>‚öîÔ∏è" }
    
};

        const countryCoords = {
    "vietnam": { center: [16.4637, 107.5908], zoom: 6, adminName: "Vietnam" },
    "germany": { center: [51.1657, 10.4515], zoom: 6, adminName: "Germany" },
    "china": { center: [35.8617, 104.1954], zoom: 4, adminName: "China" },
    "cuba": { center: [21.5218, -77.7812], zoom: 6, adminName: "Cuba" },
    "russia": { center: [61.524, 105.3188], zoom: 3, adminName: "Russia" },
    "usa": { center: [37.0902, -95.7129], zoom: 4, adminName: "United States of America" },
    "france": { center: [46.2276, 2.2137], zoom: 6, adminName: "France" },
    "japan": { center: [36.2048, 138.2529], zoom: 5, adminName: "Japan" },
    "south_korea": { center: [35.9078, 127.7669], zoom: 7, adminName: "South Korea" },
    "india": { center: [20.5937, 78.9629], zoom: 4, adminName: "India" },
    "brazil": { center: [-14.235, -51.9253], zoom: 4, adminName: "Brazil" },
    "united_kingdom": { center: [55.3781, -3.436], zoom: 5, adminName: "United Kingdom" },
    "canada": { center: [56.1304, -106.3468], zoom: 3, adminName: "Canada" },
    "australia": { center: [-25.2744, 133.7751], zoom: 4, adminName: "Australia" },
    "italy": { center: [41.8719, 12.5674], zoom: 6, adminName: "Italy" },
    "spain": { center: [40.4637, -3.7492], zoom: 6, adminName: "Spain" },
    "mexico": { center: [23.6345, -102.5528], zoom: 5, adminName: "Mexico" },
    "indonesia": { center: [-0.7893, 113.9213], zoom: 4, adminName: "Indonesia" },
    "thailand": { center: [15.87, 100.9925], zoom: 6, adminName: "Thailand" },
    "south_africa": { center: [-30.5595, 22.9375], zoom: 5, adminName: "South Africa" },
    "turkey": { center: [38.9637, 35.2433], zoom: 5, adminName: "Turkey" },
    "saudi_arabia": { center: [23.8859, 45.0792], zoom: 5, adminName: "Saudi Arabia" },
    "argentina": { center: [-38.4161, -63.6167], zoom: 4, adminName: "Argentina" },
    "egypt": { center: [26.8206, 30.8025], zoom: 6, adminName: "Egypt" },
    "poland": { center: [51.9194, 19.1451], zoom: 6, adminName: "Poland" },
    "ukraine": { center: [48.3794, 31.1656], zoom: 6, adminName: "Ukraine" },
    "iran": { center: [32.4279, 53.688], zoom: 5, adminName: "Iran" }
};

        // --- 1. KH·ªûI T·∫†O B·∫¢N ƒê·ªí ---
var map = L.map('map', { 
    zoomControl: false, 
    attributionControl: false, 
    preferCanvas: true 
}).setView([16.0, 108.0], 5); 

L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/dark_nolabels/{z}/{x}/{y}.png').addTo(map);

// --- 2. C·∫§U TR√åNH QU·∫¢N L√ù KH√ç H·∫¨U (QUAN TR·ªåNG) ---
// T·∫°o "khay" ch·ª©a ƒë·ªÉ c√≥ th·ªÉ b·∫≠t/t·∫Øt d·ªÖ d√†ng
let climateLayerGroup = L.layerGroup().addTo(map);

function toggleClimateLayer(mode) {
    // X√≥a s·∫°ch m·ªçi th·ª© trong khay tr∆∞·ªõc khi v·∫Ω c√°i m·ªõi (Ho·∫∑c ƒë·ªÉ tr·ªëng n·∫øu ch·ªçn "none")
    climateLayerGroup.clearLayers();
    
    if (mode === "none") return;

    const climateLineStyle = {
        color: "#ffffff",
        weight: 1,
        opacity: 0.2,
        dashArray: "5, 10",
        interactive: false
    };

    // A. V·∫Ω c√°c ƒë∆∞·ªùng Vƒ© ƒë·ªô (N·∫øu ch·ªçn 'lines' ho·∫∑c 'all')
    if (mode === "lines" || mode === "all") {
        const latitudes = [
            { lat: 66.5,  name: "Arctic Circle - V√íNG C·ª∞C B·∫ÆC" },
            { lat: 23.5,  name: "Tropic of Cancer - CH√ç TUY·∫æN B·∫ÆC" },
            { lat: 0,     name: "EQUADOR - ƒê∆Ø·ªúNG X√çCH ƒê·∫†O", isEquator: true },
            { lat: -23.5, name: "Tropic of Capricorn - CH√ç TUY·∫æN NAM" },
            { lat: -66.5, name: "Antarctic Circle - V√íNG C·ª∞C NAM" }
        ];

        latitudes.forEach(item => {
            const style = item.isEquator ? {
                color: "#00f2ff",
                weight: 2,
                opacity: 0.6,
                dashArray: "10, 10",
                interactive: false
            } : climateLineStyle;

            L.polyline([[item.lat, -180], [item.lat, 180]], style).addTo(climateLayerGroup);

            L.marker([item.lat, 160], {
                icon: L.divIcon({
                    className: item.isEquator ? 'equator-label' : 'climate-label',
                    html: item.name,
                    iconSize: [250, 20]
                })
            }).addTo(climateLayerGroup);
        });
    }

    // B. V·∫Ω t√™n c√°c ƒê·ªõi kh√≠ h·∫≠u (N·∫øu ch·ªçn 'zones' ho·∫∑c 'all')
    if (mode === "zones" || mode === "all") {
        const zones = [
            { lat: 75,  name: "North Frigid Zone - H√ÄN ƒê·ªöI B·∫ÆC" },
            { lat: 45,  name: "North Temperate Zone - √îN ƒê·ªöI B·∫ÆC" },
            { lat: 12,  name: "Torrid Zone - NHI·ªÜT ƒê·ªöI" },
            { lat: -12, name: "Torrid Zone - NHI·ªÜT ƒê·ªöI" },
            { lat: -45, name: "South Temperate Zone - √îN ƒê·ªöI NAM" },
            { lat: -75, name: "South Frigid Zone - H√ÄN ƒê·ªöI NAM" }
        ];

        zones.forEach(zone => {
            L.marker([zone.lat, 0], {
                icon: L.divIcon({
                    className: 'climate-zone-text',
                    html: zone.name,
                    iconSize: [300, 20]
                })
            }).addTo(climateLayerGroup);
        });
    }
}

// --- 3. ƒê·∫¢M B·∫¢O SLIDER KH√îNG B·ªä L·ªñI K√âO ---
const mainSlider = document.getElementById('slider');
if(mainSlider) {
    mainSlider.addEventListener('mousedown', () => map.dragging.disable());
    document.addEventListener('mouseup', () => map.dragging.enable());
}

        // --- KHAI B√ÅO BI·∫æN TO√ÄN C·ª§C ---
        let geojsonLayer;
        let worldDataCache = null;
        let customColoredCountries = {}; 
        let activeAlliance = null;
        let flyTimer;

        map.on('mousemove', function(e) {
            document.getElementById('coords-box').innerHTML = `LAT: ${e.latlng.lat.toFixed(4)} | LNG: ${e.latlng.lng.toFixed(4)}`;
        });

        const islandMarkers = [
            L.marker([16.5, 112.0], { icon: L.divIcon({ className: 'island-label', html: 'Ho√†ng Sa (VN)' }) }),
            L.marker([10.0, 114.5], { icon: L.divIcon({ className: 'island-label', html: 'Tr∆∞·ªùng Sa (VN)' }) }),
            L.marker([10.2, 103.9], { icon: L.divIcon({ className: 'island-label', html: 'ƒê·∫£o Ph√∫ Qu·ªëc (VN)' }) })
        ];

        function updateLabels() {
            const z = map.getZoom();
            islandMarkers.forEach(m => {
                if (z < 4) { if (map.hasLayer(m)) map.removeLayer(m); }
                else { if (!map.hasLayer(m)) m.addTo(map); }
            });
        }

        async function fetchBorders() {
            try {
                const response = await fetch('https://raw.githubusercontent.com/datasets/geo-countries/master/data/countries.geojson');
                worldDataCache = await response.json();
                renderBorders(document.getElementById('year-input').value);
            } catch (err) {
                console.warn("L·ªói t·∫£i bi√™n gi·ªõi.");
            }
        }

        function renderBorders(year) {
            if (!worldDataCache) return;
            if (geojsonLayer) map.removeLayer(geojsonLayer);

            const selectedCountry = document.getElementById('country-select').value.toLowerCase();
            
            geojsonLayer = L.geoJSON(worldDataCache, {
                style: (feature) => {
                    const name = feature.properties.ADMIN || feature.properties.name || "";
                    let isHighlighted = false;
                    let isCustom = customColoredCountries[name];

                    if (activeAlliance && activeAlliance.includes(name)) {
                        isHighlighted = true;
                    } 
                    else if (selectedCountry && countryCoords[selectedCountry]) {
                        const targetAdmin = countryCoords[selectedCountry].adminName;
                        if (name === targetAdmin || (selectedCountry === "vietnam" && (name === "Vietnam" || name === "Viet Nam"))) {
                            isHighlighted = true;
                        }
                    }

                    return {
                        color: isHighlighted ? "#ff0000" : (isCustom ? "#ffcc00" : "#00FF00"),
                        weight: (isHighlighted || isCustom) ? 3 : 1,
                        fillColor: isHighlighted ? "#ff0000" : (isCustom ? "#ffcc00" : "transparent"),
                        fillOpacity: (isHighlighted || isCustom) ? 0.4 : 0.05,
                        dashArray: (isHighlighted || isCustom) ? "" : "3, 3",
                        interactive: true 
                    };
                },
                onEachFeature: (feature, layer) => {
                    layer.on('click', function (e) {
                        const countryName = feature.properties.ADMIN || feature.properties.name;
                        L.popup().setLatLng(e.latlng).setContent(`
                            <div style="color:black; font-family:Arial; padding:5px;">
                                <b style="font-size:14px;">${countryName}</b><br>
                                <button onclick="fetchWiki('${countryName}')" style="margin-top:8px; cursor:pointer; background:#00FF00; border:none; border-radius:4px; padding:4px 8px; font-weight:bold;">TRA C·ª®U WIKI</button>
                            </div>
                        `).openOn(map);
                        fetchWiki(countryName); 
                    });
                    layer.on('dblclick', function (e) {
                        const countryName = feature.properties.ADMIN || feature.properties.name;
                        customColoredCountries[countryName] = !customColoredCountries[countryName];
                        renderBorders(document.getElementById('year-input').value);
                        L.DomEvent.stopPropagation(e);
                    });
                }
            }).addTo(map);
            geojsonLayer.bringToBack();
        }

        // --- DANH S√ÅCH T·ªåA ƒê·ªò KHU V·ª∞C (ƒê√É KH√îI PH·ª§C ƒê·∫¶Y ƒê·ª¶) ---
        const regionCoords = {
        // --- C√ÅC LI√äN MINH QU·ªêC T·∫æ ---
            'asean': { center: [10.8, 110.0], zoom: 4, countries: ["East Timor", "Vietnam", "Viet Nam", "Thailand", "Cambodia", "Laos", "Myanmar", "Philippines", "Malaysia", "Indonesia", "Brunei", "Timor-Leste", "Singapore"] },
            'eu': { center: [50.0, 10.0], zoom: 4, countries: ["Austria", "Belgium", "Bulgaria", "Croatia", "Cyprus", "Czech Republic", "Denmark", "Estonia", "Finland", "France", "Germany", "Greece", "Hungary", "Ireland", "Italy", "Latvia", "Lithuania", "Luxembourg", "Malta", "Netherlands", "Poland", "Portugal", "Romania", "Slovakia", "Slovenia", "Spain" ,	"Sweden"] },
            'nato': { center: [45.0, -20.0], zoom: 3, countries: ["Belgium","Canada","Denmark","France","Iceland","Italy","Luxembourg","Netherlands","Norway","Portugal","United Kingdom","United States of America","Greece","Turkey","Germany","Spain","Czech Republic","Hungary","Poland","Bulgaria","Estonia","Latvia","Lithuania","Romania","Slovakia","Slovenia","Albania","Croatia","Montenegro","North Macedonia","Finland","Sweden"] },
            'brics': { center: [0.0, 20.0], zoom: 2, countries: ["Brazil", "Russia", "India", "China", "South Africa", "Egypt", "Ethiopia", "Iran", "United Arab Emirates"] },
            'un': { center: [20.0, 0.0], zoom: 2, countries: ["United States of America", "Russia", "China", "France", "United Kingdom", "Afghanistan", "Albania", "Algeria", "Andorra", "Angola", "Antigua and Barbuda", "Argentina", "Armenia", "Australia", "Austria", "Azerbaijan", "Bahamas", "Bahrain", "Bangladesh", "Barbados", "Belarus", "Belgium", "Belize", "Benin", "Bhutan", "Bolivia", "Bosnia and Herzegovina", "Botswana", "Brazil", "Brunei", "Bulgaria", "Burkina Faso", "Burundi", "Cabo Verde", "Cambodia", "Cameroon", "Canada", "Central African Republic", "Chad", "Chile", "Colombia", "Comoros", "Congo", "Costa Rica", "Croatia", "Cuba", "Cyprus", "Czech Republic", "Denmark", "Djibouti", "Dominica", "Dominican Republic", "Ecuador", "Egypt", "El Salvador", "Equatorial Guinea", "Eritrea", "Estonia", "Eswatini", "Ethiopia", "Fiji", "Finland", "France", "Gabon", "Gambia", "Georgia", "Germany", "Ghana", "Greece", "Grenada", "Guatemala", "Guinea", "Guinea-Bissau", "Guyana", "Haiti", "Honduras", "Hungary", "Iceland", "India", "Indonesia", "Iran", "Iraq", "Ireland", "Israel", "Italy", "Jamaica", "Japan", "Jordan", "Kazakhstan", "Kenya", "Kiribati", "Kuwait", "Kyrgyzstan", "Laos", "Latvia", "Lebanon", "Lesotho", "Liberia", "Libya", "Liechtenstein", "Lithuania", "Luxembourg", "Madagascar", "Malawi", "Malaysia", "Maldives", "Mali", "Malta", "Marshall Islands", "Mauritania", "Mauritius", "Mexico", "Micronesia", "Moldova", "Monaco", "Mongolia", "Montenegro", "Morocco", "Mozambique", "Myanmar", "Namibia", "Nauru", "Nepal", "Netherlands", "New Zealand", "Nicaragua", "Niger", "Nigeria", "North Korea", "North Macedonia", "Norway", "Oman", "Pakistan", "Palau", "Panama", "Papua New Guinea", "Paraguay", "Peru", "Philippines", "Poland", "Portugal", "Qatar", "Romania", "Russia", "Rwanda", "Saint Kitts and Nevis", "Saint Lucia", "Saint Vincent and the Grenadines", "Samoa", "San Marino", "Sao Tome and Pr√≠ncipe", "Saudi Arabia", "Senegal", "Serbia", "Seychelles", "Sierra Leone", "Singapore", "Slovakia", "Slovenia", "Solomon Islands", "Somalia", "South Africa", "South Korea", "South Sudan", "Spain", "Sri Lanka", "Sudan", "Suriname", "Sweden", "Switzerland", "Syria", "Tajikistan", "Tanzania", "Thailand", "Timor-Leste", "Togo", "Tonga", "Trinidad and Tobago", "Tunisia", "Turkey", "Turkmenistan", "Tuvalu", "Uganda", "Ukraine", "United Arab Emirates", "United Kingdom", "Uruguay", "Uzbekistan", "Vanuatu", "Venezuela", "Vietnam", "Yemen", "Zambia", "Zimbabwe"] },
            'commonwealth': { center: [10.0, 20.0], zoom: 2, countries: ["United Kingdom", "Canada", "Australia", "New Zealand", "India", "South Africa", "Pakistan", "Bangladesh", "Nigeria", "Malaysia", "Singapore"] },
            'warsaw': { center: [52.0, 20.0], zoom: 4, countries: ["Russia", "Poland", "Germany", "Czech Republic", "Slovakia", "Hungary", "Romania", "Bulgaria", "Albania"] },
            'african_union': { center: [0.0, 20.0], zoom: 3, countries: ["Algeria", "Angola", "Benin", "Botswana", "Burkina Faso", "Burundi", "Cabo Verde", "Cameroon", "Central African Republic", "Chad", "Comoros", "Republic of the Congo", "Democratic Republic of the Congo", "Djibouti", "Egypt", "Equatorial Guinea", "Eritrea", "Eswatini", "Ethiopia", "Gabon", "Gambia", "Ghana", "Guinea", "Guinea-Bissau", "Ivory Coast", "Kenya", "Lesotho", "Liberia", "Libya", "Madagascar", "Malawi", "Mali", "Mauritania", "Mauritius", "Morocco", "Mozambique", "Namibia", "Niger", "Nigeria", "Rwanda", "S√£o Tom√© and Pr√≠ncipe", "Senegal", "Seychelles", "Sierra Leone", "Somalia", "South Africa", "South Sudan", "Sudan", "United Republic of Tanzania", "Togo", "Tunisia", "Uganda", "Zambia", "Zimbabwe"] },
            'arab_league': { center: [25.0, 15.0], zoom: 3, countries: ["Algeria", "Bahrain", "Comoros", "Djibouti", "Egypt", "Iraq", "Jordan", "Kuwait", "Lebanon", "Libya", "Mauritania", "Morocco", "Oman"] },
            'opec': { center: [20.0, 20.0], zoom: 2, countries: ["Algeria", "Angola", "Ecuador", "Gabon", "Indonesia", "Iran", "Iraq", "Kuwait", "Libya", "Nigeria", "Qatar", "Saudi Arabia", "United Arab Emirates", "Venezuela" ] },
            'mercosur': { center: [-15.0, -60.0], zoom: 3, countries: ["Argentina", "Brazil", "Paraguay", "Uruguay", "Venezuela"] },
            'mena': { center: [25.0, 10.0], zoom: 3, countries: ["Algeria", "Bahrain", "Djibouti", "Egypt", "Iran", "Iraq", "Jordan", "Kuwait", "Lebanon", "Libya", "Morocco", "Oman", "Qatar", "Saudi Arabia", "Syria", "Tunisia", "United Arab Emirates", "Yemen"] },
            'g7': { center: [45.0, -10.0], zoom: 2, countries: ["Canada", "France", "Germany", "Italy", "Japan", "United Kingdom", "United States of America"] },
        
        // --- C√ÅC KHU V·ª∞C TO√ÄN CH√ÇU ---
            'asia': { center: [30.0, 90.0], zoom: 3, countries: ["Taiwan", "Russia", "Afghanistan", "Armenia", "Azerbaijan", "Bahrain", "Bangladesh", "Bhutan", "Brunei Darussalam", "Cambodia", "China", "Cyprus", "Georgia", "India", "Indonesia", "Iran", "Iraq", "Israel", "Japan", "Jordan", "Kazakhstan", "Kuwait", "Kyrgyzstan", "Laos", "Lebanon", "Malaysia", "Maldives", "Mongolia", "Myanmar", "Nepal", "North Korea", "Oman", "Pakistan", "Palestine", "Philippines", "Qatar", "Saudi Arabia", "Singapore", "South Korea", "Sri Lanka", "Syria", "Tajikistan", "Thailand", "Timor-Leste", "Turkey", "Turkmenistan", "United Arab Emirates", "Uzbekistan", "Vietnam", "Yemen"] },
            'europe': { center: [52.0, 15.0], zoom: 4, countries: ["Albania", "Andorra", "Austria", "Belarus", "Belgium", "Bosnia and Herzegovina", "Bulgaria", "Croatia", "Czechia", "Denmark", "Estonia", "Finland", "France", "Germany", "Greece", "Hungary", "Iceland", "Ireland", "Italy", "Latvia", "Lithuania", "Luxembourg", "Malta", "Moldova", "Monaco", "Montenegro", "Netherlands", "North Macedonia", "Norway", "Poland", "Portugal", "Romania", "Russia", "San Marino", "Republic of Serbia", "Slovakia", "Slovenia", "Spain", "Sweden", "Switzerland", "Ukraine", "United Kingdom", "Vatican City", "Liechtenstein"] },
            'africa': { center: [0.0, 20.0], zoom: 3, countries: ["Algeria", "Angola", "Benin", "Botswana", "Burkina Faso", "Burundi", "Cabo Verde", "Cameroon", "Central African Republic", "Chad", "Comoros", "Republic of the Congo", "Democratic Republic of the Congo", "Djibouti", "Egypt", "Equatorial Guinea", "Eritrea", "Eswatini", "Ethiopia", "Gabon", "Gambia", "Ghana", "Guinea", "Guinea-Bissau", "Ivory Coast", "Kenya", "Lesotho", "Liberia", "Libya", "Madagascar", "Malawi", "Mali", "Mauritania", "Mauritius", "Morocco", "Mozambique", "Namibia", "Niger", "Nigeria", "Rwanda", "S√£o Tom√© and Pr√≠ncipe", "Senegal", "Seychelles", "Sierra Leone", "Somaliland", "South Africa", "South Sudan", "Sudan", "United Republic of Tanzania", "Togo", "Tunisia", "Uganda", "Zambia", "Zimbabwe", "Somalia"] },
            'americas': { center: [15.0, -85.0], zoom: 3, countries: ["United States of America", "Canada", "Mexico", "Brazil", "Argentina", "Chile", "Colombia", "Peru", "Venezuela", "Ecuador", "Bolivia", "Paraguay", "Uruguay", "Guyana", "Suriname", "Guatemala", "Belize", "Honduras", "El Salvador", "Nicaragua", "Costa Rica", "Panama", "Cuba", "Jamaica", "Haiti", "Dominican Republic"] },
            'oceania': { center: [-25.0, 140.0], zoom: 4, countries: ["Australia", "New Zealand", "Papua New Guinea", "Fiji", "Solomon Islands", "Vanuatu"] },
            'antarctica': { center: [-80.0, 0.0], zoom: 3, countries: ["Antarctica"] },
            'zealandia': { center: [-40.0, 170.0], zoom: 4, countries: ["New Zealand", "New Caledonia"] },
        // --- C√ÅC TI·ªÇU V√ôNG CH√ÇU √Å ---
            'east_asia': { center: [35.0, 110.0], zoom: 4, countries: ["China", "Japan", "South Korea", "North Korea", "Mongolia", "Taiwan"] },
            'south_asia': { center: [22.0, 78.0], zoom: 4, countries: ["India", "Pakistan", "Bangladesh", "Sri Lanka", "Nepal", "Bhutan", "Afghanistan"] },
            'north_asia': { center: [60.0, 100.0], zoom: 3, countries: ["Russia", "Mongolia"] },
            'middle_east': { center: [30.0, 40.0], zoom: 4, countries: ["Saudi Arabia", "Iran", "Iraq", "Turkey", "United Arab Emirates", "Israel", "Jordan", "Kuwait", "Oman", "Qatar", "Syria", "Yemen"] },
            'southeast_asia': { center: [10.0, 105.0], zoom: 4, countries: ["Indonesia", "Malaysia", "Philippines", "Singapore", "Thailand", "Vietnam", "Viet Nam", "Cambodia", "Laos", "Myanmar", "Brunei Darussalam", "Timor-Leste"] },
            'west_asia': { center: [25.0, 45.0], zoom: 4, countries: ["Saudi Arabia", "Iran", "Iraq", "Turkey", "United Arab Emirates", "Israel", "Jordan", "Kuwait", "Oman", "Qatar", "Syria", "Yemen"] },
            'central_asia': { center: [45.0, 65.0], zoom: 4, countries: ["Kazakhstan", "Kyrgyzstan", "Tajikistan", "Turkmenistan", "Uzbekistan"] },
        // --- C√ÅC TI·ªÇU V√ôNG CH√ÇU √ÇU ---
            'northern_europe': { center: [62.0, 15.0], zoom: 4, countries: ["Norway", "Sweden", "Finland", "Denmark", "Iceland", "Estonia", "Latvia", "Lithuania"] },
            'southern_europe': { center: [40.0, 15.0], zoom: 5, countries: ["Italy", "Spain", "Portugal", "Greece", "Albania", "Croatia", "Serbia", "Slovenia", "Montenegro"] },
            'western_europe': { center: [48.0, 2.0], zoom: 5, countries: ["France", "Belgium", "Netherlands", "Luxembourg", "Switzerland", "Austria", "Germany", "United Kingdom", "Ireland"] },
            'central_europe': { center: [50.0, 15.0], zoom: 5, countries: ["Germany", "Poland", "Czech Republic", "Slovakia", "Hungary", "Switzerland", "Austria", "Slovenia", "Croatia"] },
            'eastern_europe': { center: [50.0, 30.0], zoom: 4, countries: ["Russia", "Ukraine", "Poland", "Romania", "Bulgaria", "Hungary", "Czech Republic", "Slovakia", "Belarus", "Moldova"] },
        // --- C√ÅC TI·ªÇU V√ôNG CH√ÇU M·ª∏ ---
            'north_america': { center: [45.0, -100.0], zoom: 3, countries: ["United States of America", "Canada", "Mexico", "Greenland"] },
            'central_america': { center: [15.0, -85.0], zoom: 5, countries: ["Guatemala", "Belize", "El Salvador", "Honduras", "Nicaragua", "Costa Rica", "Panama"] },
            'south_america': { center: [-20.0, -60.0], zoom: 3, countries: ["Brazil", "Argentina", "Chile", "Colombia", "Peru", "Venezuela", "Ecuador", "Bolivia", "Paraguay", "Uruguay", "Guyana", "Suriname"] },
        // --- C√ÅC TI·ªÇU V√ôNG CH√ÇU PHI ---
            'north_africa': { center: [25.0, 15.0], zoom: 4, countries: ["Egypt", "Libya", "Tunisia", "Algeria", "Morocco", "Western Sahara", "Sudan"] },
            'west_africa': { center: [15.0, 0.0], zoom: 4, countries: ["Nigeria", "Ghana", "Senegal", "Mali", "Ivory Coast", "Niger", "Burkina Faso", "Guinea", "Benin", "Togo", "Sierra Leone", "Liberia", "Mauritania", "Gambia", "Guinea-Bissau"] },
            'central_africa': { center: [0.0, 20.0], zoom: 4, countries: ["Democratic Republic of the Congo", "Republic of the Congo", "Central African Republic", "Chad", "Cameroon", "Gabon", "Equatorial Guinea", "S√£o Tom√© and Pr√≠ncipe"] },
            'east_africa': { center: [5.0, 40.0], zoom: 4, countries: ["Kenya", "Tanzania", "Uganda", "Ethiopia", "Somalia", "Rwanda", "Burundi", "South Sudan", "Djibouti", "Eritrea"] },
            'north_east_africa': { center: [20.0, 50.0], zoom: 4, countries: ["Sudan", "Eritrea", "Djibouti", "Somalia", "Ethiopia"] },
            'East_southern_africa': { center: [-10.0, 35.0], zoom: 4, countries: ["Kenya", "Tanzania", "Uganda", "Malawi", "Mozambique", "Zambia", "Zimbabwe", "Madagascar"] },
            'central_southern_africa': { center: [-10.0, 25.0], zoom: 4, countries: ["Democratic Republic of the Congo", "Angola", "Zambia", "Malawi", "Mozambique", "Zimbabwe", "Botswana", "Namibia"] },
            'north_west_africa': { center: [15.0, -10.0], zoom: 4, countries: ["Mali", "Mauritania", "Senegal", "Gambia", "Guinea", "Guinea-Bissau", "Sierra Leone", "Liberia", "Ivory Coast"] },
            'south_west_africa': { center: [-15.0, 10.0], zoom: 4, countries: ["Angola", "Namibia", "Botswana", "South Africa", "Lesotho", "Swaziland"] },
            'west_southern_africa': { center: [-20.0, 15.0], zoom: 4, countries: ["Angola", "Namibia", "Botswana", "Zambia", "Zimbabwe", "South Africa"] },
            'southern_africa': { center: [-25.0, 25.0], zoom: 4, countries: ["South Africa", "Namibia", "Botswana", "Zimbabwe", "Mozambique", "Lesotho", "Swaziland"] },
        // --- ƒê·∫†I D∆Ø∆†NG & KH√ÅC ---
            'australasia': { center: [-25.0, 135.0], zoom: 4, countries: ["Australia", "New Zealand"] },
            'melanesia': { center: [-8.0, 150.0], zoom: 4, countries: ["Papua New Guinea", "Fiji", "Solomon Islands", "Vanuatu"] },
            'micronesia': { center: [7.0, 150.0], zoom: 4, countries: ["Palau", "Kiribati", "Marshall Islands", "Nauru"] },
            'polynesia': { center: [-15.0, -160.0], zoom: 3, countries: ["Samoa", "Tonga", "Tuvalu", "Cook Islands", "French Polynesia"] }
        };

        function flyToRegion(region) {
            if (!region) {
                activeAlliance = null;
                renderBorders(document.getElementById('year-input').value);
                return;
            }
            const data = regionCoords[region];
            if (data) {
                activeAlliance = data.countries;
                renderBorders(document.getElementById('year-input').value);
                map.flyTo(data.center, data.zoom);
            }
        }

        async function fetchWiki(eventName) {
            const panel = document.getElementById('wiki-panel');
            const body = document.getElementById('wiki-body');
            const title = document.getElementById('wiki-title');
            const wikiMap = {
                "Vi·ªát Nam Tuy√™n Ng√¥n ƒê·ªôc L·∫≠p Ng√†y 2 Th√°ng 9": "Tuy√™n ng√¥n ƒë·ªôc l·∫≠p Vi·ªát Nam D√¢n ch·ªß C·ªông h√≤a",
                "Chi·∫øn th·∫Øng R·∫°ch G·∫ßm - Xo√†i M√∫t": "Tr·∫≠n R·∫°ch G·∫ßm ‚Äì Xo√†i M√∫t",
                "Hi·ªáp ƒë·ªãnh Gen√®ve - Chia c·∫Øt Vi·ªát Nam": "Hi·ªáp ƒë·ªãnh Gen√®ve (1954)",
                "Gi·∫£i ph√≥ng mi·ªÅn Nam - Th·ªëng nh·∫•t ƒë·∫•t n∆∞·ªõc": "S·ª± ki·ªán 30 th√°ng 4 nƒÉm 1975",
                "Tr·∫≠n chi·∫øn G·∫°c Ma": "H·∫£i chi·∫øn G·∫°c Ma 1988",
                "Chi·∫øn tranh bi√™n gi·ªõi Vi·ªát - Trung": "Chi·∫øn tranh bi√™n gi·ªõi Vi·ªát‚ÄìTrung, 1979",
                "H·∫£i chi·∫øn Ho√†ng Sa": "Tr·∫≠n h·∫£i chi·∫øn Ho√†ng Sa 1974",
                "Phong tr√†o ƒê√¥ng Du": "Phong tr√†o ƒê√¥ng Du",
                "Phong tr√†o Duy T√¢n": "Phong tr√†o Duy T√¢n",
                "Phong tr√†o C·∫ßn V∆∞∆°ng": "Phong tr√†o C·∫ßn V∆∞∆°ng",
                "Kh·ªüi nghƒ©a Y√™n B√°i": "Kh·ªüi nghƒ©a Y√™n B√°i",
                "Kh·ªüi nghƒ©a B√£i S·∫≠y": "Kh·ªüi nghƒ©a B√£i S·∫≠y",
                "Kh·ªüi nghƒ©a H∆∞∆°ng Kh√™": "Kh·ªüi nghƒ©a H∆∞∆°ng Kh√™",
                "Phong tr√†o X√¥ Vi·∫øt Ngh·ªá Tƒ©nh": "X√¥ vi·∫øt Ngh·ªá Tƒ©nh",
                "Phong tr√†o V√¥ s·∫£n h√≥a": "Ch√≠nh s√°ch v√¥ s·∫£n h√≥a ·ªü Vi·ªát Nam",
                "Phong tr√†o B√¨nh d√¢n h·ªçc v·ª•": "Phong tr√†o B√¨nh d√¢n h·ªçc v·ª• ·ªü Vi·ªát Nam",
                "Phong tr√†o Nh√¢n vƒÉn - Giai ph·∫©m": "Phong tr√†o Nh√¢n vƒÉn - Giai ph·∫©m",
                "Phong tr√†o T√¢y S∆°n": "T√¢y S∆°n (phong tr√†o)",
                "Chi·∫øn d·ªãch ƒêi·ªán Bi√™n Ph·ªß": "Chi·∫øn d·ªãch ƒêi·ªán Bi√™n Ph·ªß",
                "Chi·∫øn d·ªãch H·ªì Ch√≠ Minh": "Chi·∫øn d·ªãch H·ªì Ch√≠ Minh",  
                "Chi·∫øn d·ªãch Bi√™n Gi·ªõi Thu - ƒê√¥ng 1950": "Chi·∫øn d·ªãch Bi√™n gi·ªõi Thu ‚Äì ƒê√¥ng 1950",
                "Chi·∫øn d·ªãch T√¢y Nguy√™n": "Chi·∫øn d·ªãch T√¢y Nguy√™n",   
                "Chi·∫øn d·ªãch M·∫≠u Th√¢n 1968": "T·ªïng ti·∫øn c√¥ng v√† n·ªïi d·∫≠y T·∫øt M·∫≠u Th√¢n",
                "Phong tr√†o ƒê·ªìng Kh·ªüi": "Phong tr√†o ƒê·ªìng Kh·ªüi",
                "Phong tr√†o Nh√¢n d√¢n Vi·ªát Nam": "Phong tr√†o Nh√¢n d√¢n Vi·ªát Nam ch·ªëng Ph√°p",
                "Phong tr√†o Ch·∫•n H∆∞ng ƒê·∫°o ƒê·ª©c": "Phong tr√†o Ch·∫•n H∆∞ng ƒê·∫°o ƒê·ª©c",
                "Phong tr√†o Thi√™n Ch√∫a Gi√°o C·ª©u Qu·ªëc": "Phong tr√†o Thi√™n Ch√∫a Gi√°o C·ª©u Qu·ªëc",           
                "Phong tr√†o H√≤a H·∫£o": "H√≤a H·∫£o",
                "Phong tr√†o Cao ƒê√†i": "Cao ƒê√†i",     
                "Phong tr√†o Vi·ªát Nam Qu·ªëc D√¢n ƒê·∫£ng": "Vi·ªát Nam Qu·ªëc D√¢n ƒê·∫£ng",
                "Phong tr√†o ƒê·∫£ng C·ªông s·∫£n Vi·ªát Nam": "ƒê·∫£ng C·ªông s·∫£n Vi·ªát Nam",    
                "Phong tr√†o ƒê√¥ng Kinh Nghƒ©a Th·ª•c": "ƒê√¥ng Kinh Nghƒ©a Th·ª•c",
                "Chi·∫øn d·ªãch Bi√™n Gi·ªõi 1950": "Chi·∫øn d·ªãch Bi√™n gi·ªõi Thu ‚Äì ƒê√¥ng 1950",
                "Chi·∫øn d·ªãch Qu·∫£ng Tr·ªã 1972": "Chi·∫øn d·ªãch Qu·∫£ng Tr·ªã (1972)",
                "H·∫£i chi·∫øn Tr∆∞·ªùng Sa 1988": "H·∫£i chi·∫øn Tr∆∞·ªùng Sa 1988",
            };
            const searchName = wikiMap[eventName] || eventName;
            title.innerText = eventName;
            panel.classList.add('active');
            body.innerHTML = "ƒêang t·∫£i...";
            try {
                const response = await fetch(`https://vi.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(searchName)}`);
                const data = await response.json();
                body.innerHTML = data.extract ? `<p>${data.extract}</p><a href="${data.content_urls.desktop.page}" target="_blank">Xem th√™m</a>` : "Kh√¥ng t√¨m th·∫•y b√†i vi·∫øt.";
            } catch { body.innerHTML = "L·ªói t·∫£i d·ªØ li·ªáu."; }
        }

        function updateSystem(val, manualMode = false) {
            if (manualMode) activeAlliance = null; 
            let year = parseInt(val);
            document.getElementById('year-input').value = year; 
            document.getElementById('slider').value = year;
            const selectedCountry = document.getElementById('country-select').value;
            const dataYear = historyData[year];
            let eventName = (dataYear && dataYear.country === selectedCountry) ? dataYear.text : "...";
            document.getElementById('event-val').innerHTML = eventName;
            renderBorders(year);
            if (eventName !== "...") fetchWiki(eventName);
            else document.getElementById('wiki-panel').classList.remove('active');

            clearTimeout(flyTimer);
            flyTimer = setTimeout(() => {
                if (manualMode && countryCoords[selectedCountry]) map.flyTo(countryCoords[selectedCountry].center, countryCoords[selectedCountry].zoom);
            }, 250);
        }

        // --- C√ÅC S·ª∞ KI·ªÜN ƒêI·ªÄU KHI·ªÇN ---
        fetchBorders();
        document.getElementById('slider').oninput = (e) => updateSystem(e.target.value);
        document.getElementById('year-input').oninput = (e) => updateSystem(e.target.value);
        document.getElementById('country-select').onchange = () => updateSystem(document.getElementById('year-input').value, true);
        document.getElementById('wiki-close').onclick = () => document.getElementById('wiki-panel').classList.remove('active');
        
        document.getElementById('screenshot-btn').onclick = function() {
            this.style.display = 'none';
            html2canvas(document.body, { useCORS: true }).then(canvas => {
                const link = document.createElement('a');
                link.download = `Map_${document.getElementById('year-input').value}.png`;
                link.href = canvas.toDataURL();
                link.click();
                this.style.display = 'block';
            });
        };

        map.on('zoomend', updateLabels);
        // --- LOGIC ·∫®N/HI·ªÜN PANEL ƒêI·ªÄU KHI·ªÇN ---
const uiPanel = document.getElementById('ui-panel');
const toggleBtn = document.getElementById('toggle-ui');
let isHidden = false;

toggleBtn.onclick = function() {
    if (!isHidden) {
        // ·∫®n xu·ªëng: d·ªãch chuy·ªÉn xu·ªëng 85% chi·ªÅu cao c·ªßa n√≥, ch·ªâ ƒë·ªÉ l·∫°i c√°i n√∫t
        uiPanel.style.transform = 'translateX(-50%) translateY(85%)';
        toggleBtn.innerHTML = '‚ñ≤'; // ƒê·ªïi m≈©i t√™n ch·ªâ l√™n
    } else {
        // Hi·ªán l√™n: quay v·ªÅ v·ªã tr√≠ c≈©
        uiPanel.style.transform = 'translateX(-50%) translateY(0)';
        toggleBtn.innerHTML = '‚ñº'; // ƒê·ªïi m≈©i t√™n ch·ªâ xu·ªëng
    }
    isHidden = !isHidden;
    // 1. Khai b√°o m·ªôt c√°i "khay" ƒë·ªÉ ch·ª©a c√°c ƒë∆∞·ªùng kh√≠ h·∫≠u
let climateLayerGroup = L.layerGroup().addTo(map); 

function toggleClimateLayer(mode) {
    // X√≥a s·∫°ch m·ªçi th·ª© trong khay (l√†m ch√∫ng bi·∫øn m·∫•t ho√†n to√†n kh·ªèi map)
    climateLayerGroup.clearLayers();

    if (mode === "none") return; // N·∫øu ch·ªçn T·∫Øt th√¨ d·ª´ng l·∫°i ·ªü ƒë√¢y

    // A. V·∫Ω c√°c ƒë∆∞·ªùng Vƒ© ƒë·ªô
    if (mode === "lines" || mode === "all") {
        const latitudes = [
            { lat: 66.5, name: "Arctic Circle - V√≤ng C·ª±c B·∫Øc" },
            { lat: 23.5, name: "Tropic of Cancer - Ch√≠ Tuy·∫øn B·∫Øc" },
            { lat: 0, name: "Equator - X√≠ch ƒê·∫°o", isEquator: true },
            { lat: -23.5, name: "Tropic of Capricorn - Ch√≠ Tuy·∫øn Nam" },
            { lat: -66.5, name: "Antarctic Circle - V√≤ng C·ª±c Nam" }
        ];

        latitudes.forEach(item => {
            const style = item.isEquator ? 
                { color: "#00f2ff", weight: 2, opacity: 0.8, dashArray: "15, 10" } : 
                { color: "#ffffff", weight: 1, opacity: 0.4, dashArray: "8, 8" };

            L.polyline([[item.lat, -180], [item.lat, 180]], style).addTo(climateLayerGroup);
            
            L.marker([item.lat, 160], {
                icon: L.divIcon({
                    className: item.isEquator ? 'equator-label' : 'climate-label',
                    html: item.name,
                    iconSize: [250, 20]
                })
            }).addTo(climateLayerGroup);
        });
    }

    // B. V·∫Ω c√°c ƒêai kh√≠ h·∫≠u
    if (mode === "zones" || mode === "all") {
        const zones = [
            { lat: 75, name: "North Frigid Zone - H√†n ƒê·ªõi B·∫Øc" },
            { lat: 45, name: "North Temperate Zone - √în ƒê·ªõi B·∫Øc" },
            { lat: 10, name: "Torrid Zone - Nhi·ªát ƒê·ªõi" },
            { lat: -45, name: "South Temperate Zone - √în ƒê·ªõi Nam" },
            { lat: -75, name: "South Frigid Zone - H√†n ƒê·ªõi Nam" }
        ];

        zones.forEach(zone => {
            L.marker([zone.lat, 0], {
                icon: L.divIcon({
                    className: 'climate-zone-text',
                    html: zone.name,
                    iconSize: [300, 20]
                })
            }).addTo(climateLayerGroup);
        });
    }
}
};
    </script>
</body>
</html>
